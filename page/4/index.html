<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Hexo</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">





<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">
<link rel="stylesheet" href="/css/style.css">


    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">
    

    
    
    
    <style>body>.navbar,body>.section,body>.footer{opacity: 0}</style>
    

    
    
    
    


    
    

    
    
    
    

    
    
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
<style>
.pace {
  -webkit-pointer-events: none;
  pointer-events: none;

  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

.pace-inactive {
  display: none;
}

.pace .pace-progress {
  background: #3273dc;
  position: fixed;
  z-index: 2000;
  top: 0;
  right: 100%;
  width: 100%;
  height: 2px;
}
</style>

    


</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="http://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-11T13:46:05.000Z">2017-11-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/随笔/">随笔</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 295 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/11/解决win下SSH Secure Shell无法远程登录ubuntu的问题/">解决win下SSH Secure Shell无法远程登录ubuntu的问题</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>如下图所示，准备在ubuntu中部署javaweb项目，但是在windows准备用SSH Secure Shell远程登录时提示客户端与服务器端采用的压缩算法不同，经过文中五步解决问题。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-c33740db3fdd38c6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>#####1. 安装ssh服务<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure></p>
<p>#####2.启动ssh服务<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ps -e |grep ssh</span><br></pre></td></tr></table></figure></p>
<p>有sshd,说明ssh服务已经启动，如果没有启动，输入:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh start</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-a9b5b479d8ea26b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>#####3. 打开ssh配置文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></p>
<p>#####4. 修改配置文件<br>允许root用户登录，将”PermitRootLogin without-password”更改为<br>“PermitRootLogin yes”<br>然后在配置文件末尾添加：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ciphers aes128-cbc,aes192-cbc,aes256-cbc,aes128-ctr,aes192-ctr,aes256-ctr,3des-cbc,arcfour128,arcfour256,arcfour,blowfish-cbc,cast128-cbc  </span><br><span class="line">MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-sha1-96,hmac-md5-96  </span><br><span class="line">KexAlgorithms diffie-hellman-group1-sha1,diffie-hellman-group14-sha1,diffie-hellman-group-exchange-sha1,diffie-hellman-group-exchange-sha256,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group1-sha1,curve25519-sha256@libssh.org</span><br></pre></td></tr></table></figure></p>
<p>#####5. 重启ssh服务<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/ssh restart</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-2454545e08c86dd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-11T08:11:13.000Z">2017-11-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Python/">Python</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 707 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/11/Scrapy爬取西刺网站代理IP并写入MySQL/">Scrapy爬取西刺网站代理IP并写入MySQL</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>Scrapy : 1.4.0<br>Python : 3.6.2<br>MySQL : 5.6<br>Platform  : Windows-7-6.1.7601-SP1</p>
</blockquote>
<h2 id="1-目标网站分析"><a href="#1-目标网站分析" class="headerlink" title="1. 目标网站分析"></a>1. 目标网站分析</h2><blockquote>
<p>如下图所示，本文准备爬取国内高匿代理部分的IP信息，通过火狐浏览器可以看到有效信息都在id为ip_list的table里面，所以通过xpath和正则表达式即可拿到想要的信息。通过观察不同分页的url后发现从每二页开始每个url后面的数字即为当前页次，因而可以列举所有页面(本文示例代码爬取前三页)。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-c054140d2abce8c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="2-数据库准备"><a href="#2-数据库准备" class="headerlink" title="2. 数据库准备"></a>2. 数据库准备</h2><blockquote>
<p>Python需要安装MySQLdb模块，根据我们所需要的信息建表</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE proxy(</span><br><span class="line">    IP char(20),</span><br><span class="line">    PORT char(20),</span><br><span class="line">    TYPE char(20),</span><br><span class="line">    POSITION char(20),</span><br><span class="line">    SPEED char(20),</span><br><span class="line">    LAST_CHECK_TIME char(20)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="3-项目开发"><a href="#3-项目开发" class="headerlink" title="3. 项目开发"></a>3. 项目开发</h2><h6 id="3-1-在cmd下通过以下命令即可创建典型Scrapy项目结构。"><a href="#3-1-在cmd下通过以下命令即可创建典型Scrapy项目结构。" class="headerlink" title="3.1 在cmd下通过以下命令即可创建典型Scrapy项目结构。"></a>3.1 在cmd下通过以下命令即可创建典型Scrapy项目结构。</h6><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject collectips</span><br></pre></td></tr></table></figure>
<h6 id="3-2-定义Item"><a href="#3-2-定义Item" class="headerlink" title="3.2 定义Item"></a>3.2 定义Item</h6><blockquote>
<p>Item中的信息与网站和数据库对应，我们需要IP地址，端口，服务器地址，类型，速度，验证时间这六个字段。</p>
</blockquote>
<p><strong>items.py</strong><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line"></span><br><span class="line">class CollectipsItem(scrapy.Item):</span><br><span class="line">    IP = scrapy.Field()</span><br><span class="line">    PORT = scrapy.Field()</span><br><span class="line">    POSITION = scrapy.Field()</span><br><span class="line">    TYPE = scrapy.Field()</span><br><span class="line">    SPEED = scrapy.Field()</span><br><span class="line">    LAST_CHECK_TIME = scrapy.Field()</span><br></pre></td></tr></table></figure></p>
<h6 id="3-3-创建spider"><a href="#3-3-创建spider" class="headerlink" title="3.3 创建spider"></a>3.3 创建spider</h6><blockquote>
<p>通过以下命令创建名为xici的spider模板<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider xici xicidaili.com</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>然后编写具体处理逻辑：<br><strong>xici.py</strong>:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import scrapy</span><br><span class="line">from collectips.items import CollectipsItem</span><br><span class="line"></span><br><span class="line">class XiciSpider(scrapy.Spider):</span><br><span class="line">    name = &apos;xici&apos;</span><br><span class="line">    allowed_domains = [&apos;xicidaili.com&apos;]</span><br><span class="line">    start_urls = [&apos;http://www.xicidaili.com&apos;]</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        reqs = []</span><br><span class="line"></span><br><span class="line">        for i in range(1,3):</span><br><span class="line">            req = scrapy.Request(&quot;http://www.xicidaili.com/nn/%s&quot;%i)</span><br><span class="line">            reqs.append(req)</span><br><span class="line"></span><br><span class="line">        return reqs</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        ip_list = response.xpath(&apos;//table[@id=&quot;ip_list&quot;]&apos;)</span><br><span class="line"></span><br><span class="line">        trs = ip_list[0].xpath(&apos;tr&apos;)</span><br><span class="line"></span><br><span class="line">        items = []</span><br><span class="line"></span><br><span class="line">        for ip in trs[1:]:</span><br><span class="line">            pre_item = CollectipsItem()</span><br><span class="line"></span><br><span class="line">            pre_item[&apos;IP&apos;] = ip.xpath(&apos;td[2]/text()&apos;)[0].extract()</span><br><span class="line"></span><br><span class="line">            pre_item[&apos;PORT&apos;] = ip.xpath(&apos;td[3]/text()&apos;)[0].extract()</span><br><span class="line"></span><br><span class="line">            pre_item[&apos;POSITION&apos;] = ip.xpath(&apos;string(td[4])&apos;)[0].extract().strip()</span><br><span class="line"></span><br><span class="line">            pre_item[&apos;TYPE&apos;] = ip.xpath(&apos;td[6]/text()&apos;)[0].extract()</span><br><span class="line"></span><br><span class="line">            pre_item[&apos;SPEED&apos;] = ip.xpath(&apos;td[8]/div[@class=&quot;bar&quot;]/@title&apos;).re(&apos;\d&#123;0,2&#125;\.\d&#123;0,&#125;&apos;)[0]</span><br><span class="line"></span><br><span class="line">            pre_item[&apos;LAST_CHECK_TIME&apos;] = ip.xpath(&apos;td[10]/text()&apos;)[0].extract()</span><br><span class="line"></span><br><span class="line">            items.append(pre_item)</span><br><span class="line"></span><br><span class="line">        return items</span><br></pre></td></tr></table></figure></p>
<h6 id="3-3-相关参数设置"><a href="#3-3-相关参数设置" class="headerlink" title="3.3 相关参数设置"></a>3.3 相关参数设置</h6><blockquote>
<p>数据库连接，日志文件，代理浏览器相关设置</p>
</blockquote>
<p><strong>settings.py</strong></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">BOT_NAME = &apos;collectips&apos;</span><br><span class="line"></span><br><span class="line">SPIDER_MODULES = [&apos;collectips.spiders&apos;]</span><br><span class="line">NEWSPIDER_MODULE = &apos;collectips.spiders&apos;</span><br><span class="line"></span><br><span class="line">#database connection parameters</span><br><span class="line">DBKWARGS = &#123;&apos;db&apos;:&apos;mysql&apos;,&apos;user&apos;:&apos;root&apos;,&apos;passwd&apos;:&apos;root&apos;,</span><br><span class="line">            &apos;host&apos;:&apos;localhost&apos;,&apos;use_unicode&apos;:True,&apos;charset&apos;:&apos;utf8&apos;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    &apos;collectips.pipelines.CollectipsPipeline&apos;:300,</span><br><span class="line">&#125;</span><br><span class="line">LOG_FILE = &quot;scrapy.log&quot;</span><br><span class="line"></span><br><span class="line"># Obey robots.txt rules</span><br><span class="line">ROBOTSTXT_OBEY = True</span><br><span class="line"></span><br><span class="line">USER_AGENT = &apos;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0&apos;</span><br></pre></td></tr></table></figure>
<h6 id="3-3-数据存储"><a href="#3-3-数据存储" class="headerlink" title="3.3 数据存储"></a>3.3 数据存储</h6><blockquote>
<p>将提取的数据写入MySQL数据库，注意数据库的连接关闭和异常的获取。</p>
</blockquote>
<p><strong>pipelines.py</strong>：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import MySQLdb</span><br><span class="line"></span><br><span class="line">class CollectipsPipeline(object):</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        DBKWARGS = spider.settings.get(&apos;DBKWARGS&apos;)</span><br><span class="line">        con =  MySQLdb.connect(**DBKWARGS)</span><br><span class="line">        cur = con.cursor()</span><br><span class="line">        sql = (&quot;insert into proxy(IP,PORT,TYPE,POSITION,SPEED,LAST_CHECK_TIME) &quot;</span><br><span class="line">          &quot;values(%s,%s,%s,%s,%s,%s)&quot;)</span><br><span class="line">        lis = (item[&apos;IP&apos;],item[&apos;PORT&apos;],item[&apos;TYPE&apos;],item[&apos;POSITION&apos;],item[&apos;SPEED&apos;],</span><br><span class="line">               item[&apos;LAST_CHECK_TIME&apos;])</span><br><span class="line">        try:</span><br><span class="line">            cur.execute(sql,lis)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Insert Error:&quot;,e)</span><br><span class="line">            con.rollback()</span><br><span class="line">        else:</span><br><span class="line">            con.commit()</span><br><span class="line">        cur.close()</span><br><span class="line">        con.close()</span><br><span class="line">        return item</span><br></pre></td></tr></table></figure></p>
<p>效果如下：<br><img src="http://upload-images.jianshu.io/upload_images/5990755-f2347c3e0c847f17.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-20T03:49:01.000Z">2017-08-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/随笔/">随笔</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    20 minutes read (About 3034 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/20/Google Guava Cache 全解析/">Google Guava Cache 全解析</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>Google Guava Cache是一种非常优秀本地缓存解决方案，提供了基于容量，时间和引用的缓存回收方式。基于容量的方式内部实现采用LRU算法，基于引用回收很好的利用了Java虚拟机的垃圾回收机制。其中的缓存构造器CacheBuilder采用构建者模式提供了设置好各种参数的缓存对象，缓存核心类LocalCache里面的内部类Segment与jdk1.7及以前的ConcurrentHashMap非常相似，都继承于ReetrantLock，还有六个队列，以实现丰富的本地缓存方案。<br>本文先介绍了Guava Cache囊括的基本使用方法，然后结合体系类图和LocalCache的数据结构对典型的几个方法源码进行流程分析。</p>
</blockquote>
<h2 id="为什么要用本地缓存"><a href="#为什么要用本地缓存" class="headerlink" title="为什么要用本地缓存"></a>为什么要用本地缓存</h2><blockquote>
<p><strong>相对于IO操作</strong><br>  速度快，效率高<br><strong>相对于Redis</strong><br>     Redis是一种优秀的分布式缓存实现，受限于网卡等原因，远水救不了近火。</p>
</blockquote>
<p>DB + Redis + LocalCache = 高效存储，高效访问</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-a75124e52de44256.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="什么时候用"><a href="#什么时候用" class="headerlink" title="什么时候用"></a>什么时候用</h2><ul>
<li>愿意消耗一些内存空间来提升速度</li>
<li>预料到某些键会被多次查询</li>
<li>缓存中存放的数据总量不会超出内存容量</li>
</ul>
<h2 id="怎么用"><a href="#怎么用" class="headerlink" title="怎么用"></a>怎么用</h2><ol>
<li>设置缓存容量</li>
<li>设置超时时间</li>
<li>提供移除监听器</li>
<li>提供缓存加载器</li>
<li>构建缓存</li>
</ol>
<p>Demo1:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public class GuavaCacheDemo1 &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        CacheLoader&lt;String, String&gt; loader = new CacheLoader&lt;String, String&gt; () &#123;</span><br><span class="line">            public String load(String key) throws Exception &#123;</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">                if(&quot;key&quot;.equals(key)) return null;</span><br><span class="line">                System.out.println(key + &quot; is loaded from a cacheLoader!&quot;);</span><br><span class="line">                return key + &quot;&apos;s value&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        RemovalListener&lt;String, String&gt; removalListener = new RemovalListener&lt;String, String&gt;() &#123;</span><br><span class="line">            public void onRemoval(RemovalNotification&lt;String, String&gt; removal) &#123;</span><br><span class="line">                System.out.println(&quot;[&quot; + removal.getKey() + &quot;:&quot; + removal.getValue() + &quot;] is evicted!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        LoadingCache&lt;String, String&gt; testCache = CacheBuilder.newBuilder()</span><br><span class="line">                .maximumSize(7)</span><br><span class="line">                .expireAfterWrite(10, TimeUnit.MINUTES)</span><br><span class="line">                .removalListener(removalListener)</span><br><span class="line">                .build(loader);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 10; i ++)&#123;</span><br><span class="line">            String key = &quot;key&quot; + i;</span><br><span class="line">            String value = &quot;value&quot; + i;</span><br><span class="line">            testCache.put(key,value);</span><br><span class="line">            System.out.println(&quot;[&quot; + key + &quot;:&quot; + value + &quot;] is put into cache!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(testCache.getIfPresent(&quot;key6&quot;));</span><br><span class="line"></span><br><span class="line">        try&#123;</span><br><span class="line">            System.out.println(testCache.get(&quot;key&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-9d1ed354a35b37f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><h5 id="CacheLoader"><a href="#CacheLoader" class="headerlink" title="CacheLoader"></a>CacheLoader</h5><p>如果有合理的默认方法来加载或计算与键关联的值。</p>
<p>LoadingCache是附带CacheLoader构建而成的缓存实现。创建自己的CacheLoader通常只需要简单地实现V load(K key) throws Exception方法。</p>
<p>从LoadingCache查询的正规方式是使用get(K)方法。这个方法要么返回已经缓存的值，要么使用CacheLoader向缓存原子地加载新值。由于CacheLoader可能抛出异常，LoadingCache.get(K)也声明为抛出ExecutionException异常。</p>
<h5 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h5><p>如果没有合理的默认方法来加载或计算与键关联的值，或者想要覆盖默认的加载运算，同时保留“获取缓存-如果没有-则计算”[get-if-absent-compute]的原子语义。<br>      所有类型的Guava Cache，不管有没有自动加载功能，都支持get(K, Callable<v>)方法。这个方法返回缓存中相应的值，或者用给定的Callable运算并把结果加入到缓存中。在整个加载方法完成前，缓存项相关的可观察状态都不会更改。这个方法简便地实现了模式”如果有缓存则返回；否则运算、缓存、然后返回”。</v></p>
<p>Demo2:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class GuavaCacheDemo2 &#123;</span><br><span class="line"></span><br><span class="line">    static Cache&lt;String, String&gt; testCache = CacheBuilder.newBuilder()</span><br><span class="line">            .maximumSize(3)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        testCache.put(&quot;1234&quot;,&quot;45&quot;);</span><br><span class="line"></span><br><span class="line">        System.out.println(testCache.getIfPresent(&quot;key6&quot;));</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(testCache.get(&quot;123&quot;, new Callable&lt;String&gt;() &#123;</span><br><span class="line">                public String call() throws Exception &#123;</span><br><span class="line">                    return &quot;134&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line"></span><br><span class="line">            System.out.println(testCache.get(&quot;1234&quot;, new Callable&lt;String&gt;() &#123;</span><br><span class="line">                public String call() throws Exception &#123;</span><br><span class="line">                    return &quot;134&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125; catch (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-ebcc7d45a1291cd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5 id="Cache-put"><a href="#Cache-put" class="headerlink" title="Cache.put"></a>Cache.put</h5><p>但自动加载是首选的，因为它可以更容易地推断所有缓存内容的一致性。<br>使用cache.put(key, value)方法可以直接向缓存中插入值，这会直接覆盖掉给定键之前映射的值。使用Cache.asMap()视图提供的任何方法也能修改缓存。但请注意，asMap视图的任何方法都不能保证缓存项被原子地加载到缓存中。进一步说，asMap视图的原子运算在Guava Cache的原子加载范畴之外，所以相比于Cache.asMap().putIfAbsent(K,V)，Cache.get(K, Callable<v>) 应该总是优先使用。</v></p>
<p>##缓存回收<br>Guava Cache提供了三种基本的缓存回收方式:</p>
<p>###1. 基于容量回收<br>maximumSize(long)：当缓存中的元素数量超过指定值时。</p>
<p>###2.  定时回收<br>expireAfterAccess(long, TimeUnit)：缓存项在给定时间内没有被读/写访问，则回收。请注意这种缓存的回收顺序和基于大小回收一样。<br>expireAfterWrite(long, TimeUnit)：缓存项在给定时间内没有被写访问（创建或覆盖），则回收。如果认为缓存数据总是在固定时候后变得陈旧不可用，这种回收方式是可取的。<br>如下文所讨论，定时回收周期性地在写操作中执行，偶尔在读操作中执行。</p>
<p>###3. 基于引用回收（Reference-based Eviction）<br>CacheBuilder.weakKeys()：使用弱引用存储键。当键没有其它（强或软）引用时，缓存项可以被垃圾回收。<br>CacheBuilder.weakValues()：使用弱引用存储值。当值没有其它（强或软）引用时，缓存项可以被垃圾回收。<br>CacheBuilder.softValues()：使用软引用存储值。软引用只有在响应内存需要时，才按照全局最近最少使用的顺序回收。</p>
<h2 id="显式清除"><a href="#显式清除" class="headerlink" title="显式清除"></a>显式清除</h2><p>任何时候，你都可以显式地清除缓存项，而不是等到它被回收：<br>个别清除：Cache.invalidate(key)<br>批量清除：Cache.invalidateAll(keys)<br>清除所有缓存项：Cache.invalidateAll()</p>
<h2 id="移除监听器"><a href="#移除监听器" class="headerlink" title="移除监听器"></a>移除监听器</h2><p>通过CacheBuilder.removalListener(RemovalListener)，你可以声明一个监听器，以便缓存项被移除时做一些额外操作。缓存项被移除时，RemovalListener会获取移除通知[RemovalNotification]，其中包含移除原因[RemovalCause]、键和值。</p>
<h2 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h2><p>CacheBuilder.recordStats()：用来开启Guava Cache的统计功能。统计打开后，Cache.stats()方法会返回CacheS tats 对象以提供如下统计信息：</p>
<p>hitRate()：缓存命中率；<br>averageLoadPenalty()：加载新值的平均时间，单位为纳秒；<br>evictionCount()：缓存项被回收的总数，不包括显式清除。<br>     此外，还有其他很多统计信息。这些统计信息对于调整缓存设置是至关重要的，在性能要求高的应用中我们建议密切关注这些数据。</p>
<p>Demo3:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class GuavaCacheDemo3 &#123;</span><br><span class="line"></span><br><span class="line">    static Cache&lt;String, Object&gt; testCache = CacheBuilder.newBuilder()</span><br><span class="line">            .weakValues()</span><br><span class="line">            .recordStats()</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        Object obj1 = new Object();</span><br><span class="line"></span><br><span class="line">        testCache.put(&quot;1234&quot;,obj1);</span><br><span class="line"></span><br><span class="line">        obj1 = new String(&quot;123&quot;);</span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        System.out.println(testCache.getIfPresent(&quot;1234&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(testCache.stats());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果<br><img src="http://upload-images.jianshu.io/upload_images/5990755-8967e146506898ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="LRU缓存回收算法"><a href="#LRU缓存回收算法" class="headerlink" title="LRU缓存回收算法"></a>LRU缓存回收算法</h2><blockquote>
<p>LRU（Least?recently?used，最近最少使用）算法根据数据的历史访问记录来进行淘汰数据，其核心思想是“如果数据最近被访问过，那么将来被访问的几率也更高”。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-741c8f1a5d06378b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>1.?新数据插入到链表头部；<br>2.?每当缓存命中（即缓存数据被访问），则将数据移到链表头部；<br>3.?当链表满的时候，将链表尾部的数据丢弃。</p>
<p>Guava Cache中借助读写队列来实现LRU算法。</p>
<h2 id="Guava-Cache体系类图"><a href="#Guava-Cache体系类图" class="headerlink" title="Guava Cache体系类图"></a>Guava Cache体系类图</h2><p><img src="http://upload-images.jianshu.io/upload_images/5990755-d255c245385bd624.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>#####CacheBuilder<br>缓存构建器。构建缓存的入口，指定缓存配置参数并初始化本地缓存。<br>主要采用builder的模式，CacheBuilder的每一个方法都返回这个CacheBuilder知道build方法的调用。<br>注意build方法有重载，带有参数的为构建一个具有数据加载功能的缓存，不带参数的构建一个没有数据加载功能的缓存。</p>
<p>#####LocalManualCache<br>作为LocalCache的一个内部类，在构造方法里面会把LocalCache类型的变量传入，并且调用方法时都直接或者间接调用LocalCache里面的方法。</p>
<p>#####LocalLoadingCache<br>可以看到该类继承了LocalManualCache并实现接口LoadingCache。<br>覆盖了get，getUnchecked等方法。</p>
<p>#####LocalCache<br>Guava  Cache中的核心类，重点了解。</p>
<h2 id="LocalCache数据结构"><a href="#LocalCache数据结构" class="headerlink" title="LocalCache数据结构"></a>LocalCache数据结构</h2><blockquote>
<p>根据上面的分析可知，LocalCache为Guava Cache的核心类，先看一个该类的数据结构：          LocalCache的数据结构与ConcurrentHashMap很相似，都由多个segment组成，且各segment相对独立，互不影响，所以能支持并行操作。每个segment由一个table和若干队列组成。缓存数据存储在table中，其类型为AtomicReferenceArray。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-830f3be84c774bda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>#####Segment&lt;K, V&gt;[] segments;<br>Segment继承于ReetrantLock，减小锁粒度，提高并发效率。</p>
<h5 id="AtomicReferenceArray-lt-ReferenceEntry-lt-K-V-gt-gt-table"><a href="#AtomicReferenceArray-lt-ReferenceEntry-lt-K-V-gt-gt-table" class="headerlink" title="AtomicReferenceArray&lt;ReferenceEntry&lt;K, V&gt;&gt; table;"></a>AtomicReferenceArray&lt;ReferenceEntry&lt;K, V&gt;&gt; table;</h5><p>类似于HasmMap中的table一样，相当于entry的容器。    </p>
<p> #####ReferenceEntry&lt;K, V&gt; referenceEntry;<br>基于引用的Entry,其实现类有弱引用Entry,强引用Entry等</p>
<h5 id="ReferenceQueue-keyReferenceQueue"><a href="#ReferenceQueue-keyReferenceQueue" class="headerlink" title="ReferenceQueue keyReferenceQueue;"></a>ReferenceQueue<k> keyReferenceQueue;</k></h5><p>已经被GC，需要内部清理的键引用队列。</p>
<h5 id="ReferenceQueue-valueReferenceQueue"><a href="#ReferenceQueue-valueReferenceQueue" class="headerlink" title="ReferenceQueue valueReferenceQueue;"></a>ReferenceQueue<v> valueReferenceQueue;</v></h5><p>已经被GC，需要内部清理的值引用队列。</p>
<h5 id="Queue-lt-ReferenceEntry-lt-K-V-gt-gt-recencyQueue"><a href="#Queue-lt-ReferenceEntry-lt-K-V-gt-gt-recencyQueue" class="headerlink" title="Queue&lt;ReferenceEntry&lt;K, V&gt;&gt; recencyQueue;"></a>Queue&lt;ReferenceEntry&lt;K, V&gt;&gt; recencyQueue;</h5><p>记录升级可访问列表清单时的entries,当segment上达到临界值或发生写操作时该队列会被清空。</p>
<h5 id="Queue-lt-ReferenceEntry-lt-K-V-gt-gt-writeQueue"><a href="#Queue-lt-ReferenceEntry-lt-K-V-gt-gt-writeQueue" class="headerlink" title="Queue&lt;ReferenceEntry&lt;K, V&gt;&gt; writeQueue;"></a>Queue&lt;ReferenceEntry&lt;K, V&gt;&gt; writeQueue;</h5><p>按照写入时间进行排序的元素队列，写入一个元素时会把它加入到队列尾部。</p>
<h5 id="Queue-lt-ReferenceEntry-lt-K-V-gt-gt-accessQueue"><a href="#Queue-lt-ReferenceEntry-lt-K-V-gt-gt-accessQueue" class="headerlink" title="Queue&lt;ReferenceEntry&lt;K, V&gt;&gt; accessQueue;"></a>Queue&lt;ReferenceEntry&lt;K, V&gt;&gt; accessQueue;</h5><p>按照访问时间进行排序的元素队列，访问(包括写入)一个元素时会把它加入到队列尾部。</p>
<h2 id="put"><a href="#put" class="headerlink" title="put"></a>put</h2><blockquote>
<p>public V put(K key, V value); //onlyIfAbsent为false<br>public V putIfAbsent(K key, V value); //onlyIfAbsent为true<br>      该方法显式往本地缓存里面插入值。从下面的流程图中可以看出，在执行每次put前都会进行preWriteCleanUP，在put返回前如果更新了entry则要进行evictEntries操作。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-5a92f860e91998ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="preWriteCleanup"><a href="#preWriteCleanup" class="headerlink" title="preWriteCleanup"></a>preWriteCleanup</h3><blockquote>
<p>void preWriteCleanup(long now)；<br>       传人参数只有当前时间。<br>       键值引用队列中都是存储已经被GC，等待清除的entry信息，所以首先去处理这个里面的entry.<br>       读写队列里面是按照读写时间排序的，取出队列中的首元素，如果当前时间与该元素的时间相差值大于设定值，则进行回收。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-39fe193d3ec49756.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="evictEntries"><a href="#evictEntries" class="headerlink" title="evictEntries"></a>evictEntries</h2><p>void evictEntries(ReferenceEntry&lt;K, V&gt; newest)；<br>     传入的参数为最新的Entry，可能是刚插入的，也可能是刚更新过的。<br>     该方法只有在设置了在构建缓存的时候指定了maximumSize才会往下执行。首先清除recencyQueue，判断该元素自身的权重是否超过上限，如果超过则移除当前元素。然后判断总的权重是否大于上限，如果超过则去accessQueue里找到队首(即最不常访问的元素)进行移除，直到小于上限。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-2102248edcd35bc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="getIfPresent"><a href="#getIfPresent" class="headerlink" title="getIfPresent"></a>getIfPresent</h2><blockquote>
<p>public V getIfPresent(Object key)；<br>该方法从本地缓存中找值，如果找不到返回null，找到就返回相应的值。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-a9ce9d9122100419.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><blockquote>
<p>首先会在缓存中找，缓存中找不到再通过load加载。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-533ab01915749569.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h2><blockquote>
<p>public V remove(@Nullable Object key)；<br>调用LocalManualCache的invalidate(Object key)方法即可调用remove.</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-31f0cfdd60f1c780.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-13T14:25:38.000Z">2017-08-13</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/数据结构与算法/">数据结构与算法</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 574 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/13/利用堆实现排序和解决topk问题之Java实现/">利用堆实现排序和解决topk问题之Java实现</a>
            
        </h1>
        <div class="content">
            <p>如下图，将一个数组转化堆，有如下性质</p>
<ul>
<li>#####所有父节点的值小于或等于两个子节点的值(最小堆)</li>
<li>#####如果有左子树，那么左子树的位置是2i+1，如果有右子树，右子树的位置是2i+2</li>
<li>#####只有数组下标小于或等于 【数组长度 / 2 - 1】 的元素有孩子结点</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-aa22eb96154fca9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>堆排序实现思想：</p>
<blockquote>
<p>不断构造堆，交换堆顶与末尾未排序的每一个元素，直到全部都排完。</p>
</blockquote>
<p>topK问题实现思想：</p>
<blockquote>
<p>创建一个大小为k的数组，对该数组构造堆。遍历数组中剩余的元素，依次与构建好的堆项元素比较，如果满足条件(大于或小于)则替换堆顶元素并重新构造堆。</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">public class HeapDemo &#123;</span><br><span class="line">	public static void main(String[] args)&#123;		</span><br><span class="line">		//最小堆实现从大到小排序</span><br><span class="line">		int[] arrSort = &#123;90,3,60,6,7,2,89,100,33,5&#125;;		</span><br><span class="line">		MinHeap heap1 = new MinHeap(arrSort);</span><br><span class="line">		for(int i = arrSort.length - 1;i &gt;= 0; i --)&#123;</span><br><span class="line">			//把最小的元素移到末尾</span><br><span class="line">			heap1.swap(0, i);</span><br><span class="line">			//重新构造最小堆</span><br><span class="line">			heap1.buildHeap(i);</span><br><span class="line">		&#125;</span><br><span class="line">		//打印排序后的数组</span><br><span class="line">		for(int i = 0; i &lt; arrSort.length;i ++)&#123;</span><br><span class="line">			System.out.println(arrSort[i]);</span><br><span class="line">		&#125;		</span><br><span class="line">		</span><br><span class="line">		//最小堆实现topK</span><br><span class="line">		int[] arrTopK = &#123;90,44,60,6,71,2,38,13,33,5&#125;;</span><br><span class="line">		int k = 3;</span><br><span class="line">		//创建一个大小为k的数组</span><br><span class="line">		int[] data = new int[k];</span><br><span class="line">		for(int i = 0; i &lt; k; i ++)&#123;</span><br><span class="line">			data[i] = arrTopK[i];</span><br><span class="line">		&#125;		</span><br><span class="line">		MinHeap heap = new MinHeap(data);		</span><br><span class="line">		for(int i = k; i &lt; arrTopK.length; i ++)&#123;</span><br><span class="line">			//如果大于堆顶的元素则替换顶并重新构造</span><br><span class="line">			if(arrTopK[i] &gt; heap.getRoot()) heap.setRoot(arrTopK[i]);			</span><br><span class="line">		&#125;		</span><br><span class="line">		//打印最大的k个数</span><br><span class="line">		for(int i = 0; i &lt; k; i ++)&#123;</span><br><span class="line">			System.out.println(data[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//最小堆类</span><br><span class="line">class MinHeap&#123;</span><br><span class="line">	private int[] data;</span><br><span class="line">	public MinHeap(int[] data)&#123;</span><br><span class="line">		this.data = data;</span><br><span class="line">		buildHeap();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private void buildHeap()&#123;</span><br><span class="line">		buildHeap(data.length);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void buildHeap(int heapSize)&#123;</span><br><span class="line">		for(int i = heapSize / 2 - 1; i &gt;= 0;i --)&#123;</span><br><span class="line">			heapify(i,heapSize);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private void heapify(int index)&#123;</span><br><span class="line">		heapify(index,data.length);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void heapify(int index,int heapSize)&#123;</span><br><span class="line">		int right = right(index);</span><br><span class="line">		</span><br><span class="line">		int left = left(index);</span><br><span class="line">		</span><br><span class="line">		int min = index;</span><br><span class="line">		</span><br><span class="line">		if(right &lt; heapSize &amp;&amp; data[right] &lt; data[min]) min = right;</span><br><span class="line">		</span><br><span class="line">		if(left &lt; heapSize &amp;&amp; data[left] &lt; data[min]) min = left;</span><br><span class="line">		</span><br><span class="line">		if(min == index) return;</span><br><span class="line">		</span><br><span class="line">		swap(index,min);</span><br><span class="line">		</span><br><span class="line">		heapify(min,heapSize);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private int right(int index)&#123;</span><br><span class="line">		//右儿子的下标</span><br><span class="line">		return (index + 1) &lt;&lt; 1;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private int left(int index)&#123;</span><br><span class="line">		//左儿子的下标</span><br><span class="line">		return ((index + 1) &lt;&lt; 1) - 1;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void swap(int index1,int index2)&#123;</span><br><span class="line">		int tmp = data[index1];</span><br><span class="line">		data[index1] = data[index2];</span><br><span class="line">		data[index2] = tmp;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public int getRoot()&#123;</span><br><span class="line">		return data[0];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void setRoot(int root)&#123;</span><br><span class="line">		data[0] = root;</span><br><span class="line">		heapify(0);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考文章：<br><a href="http://blog.csdn.net/xiao__gui/article/details/8687982" target="_blank" rel="noopener">http://blog.csdn.net/xiao__gui/article/details/8687982</a><br><a href="http://blog.csdn.net/kimylrong/article/details/17150475" target="_blank" rel="noopener">http://blog.csdn.net/kimylrong/article/details/17150475</a></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-06T03:37:44.000Z">2017-07-06</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Hadoop/">Hadoop</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 minutes read (About 1529 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/06/虚拟机下CentOS7.3配置hadoop2.7.0集群/">虚拟机下CentOS7.3配置hadoop2.7.0集群</a>
            
        </h1>
        <div class="content">
            <p>环境：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">主机配置：win7旗舰版64位，i5处理器，8G内存，500G固态 + 1T机械</span><br><span class="line">虚拟机软件：VMwareworkstation_full_12.1.0.2487.1453173744</span><br><span class="line">CentOS镜像：CentOS-7-x86_64-Everything-1611</span><br><span class="line">SSH工具：SecureCRT-v8.0.4</span><br><span class="line">jdk：jdk-8u131-linux-x64</span><br><span class="line">hadoop:hadoop-2.7.0.tar</span><br></pre></td></tr></table></figure></p>
<p>效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-ead591a9ec453da5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-85af6d4799a000e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5 id="1-虚拟机设置"><a href="#1-虚拟机设置" class="headerlink" title="1.虚拟机设置"></a>1.虚拟机设置</h5><blockquote>
<p>注意内存分配，由于系统只有8G内存，而需要配置一主两从，所以我将每个虚拟机的内存设置为2G.</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-196e63cdef95ec19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>centos7.3初始化时并没有ifconfig指令，需要使用下面两个指令进行安装<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum search ifconfg</span><br><span class="line">yum install net-tools.x86_64</span><br></pre></td></tr></table></figure></p>
<h5 id="2-jdk安装"><a href="#2-jdk安装" class="headerlink" title="2. jdk安装"></a>2. jdk安装</h5><p>a) 在/usr下创建java文件夹并进入该文件夹<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/java</span><br><span class="line">cd /usr/java</span><br></pre></td></tr></table></figure></p>
<p>b) 在SecureCRT中使用rz命令将真机中的jdk包传到虚拟机</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-c49068afa85eeda8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>c) 解压</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf jdk-8u45-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">// 解压后可以删除掉gz文件</span><br><span class="line">rm jdk-8u131-linux-x64.gz</span><br></pre></td></tr></table></figure>
<p>d) 配置jdk环境变量<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi   /etc/profile</span><br><span class="line"></span><br><span class="line">// 将以下数据复制到文件底部</span><br><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_131</span><br><span class="line">export JRE_HOME=/usr/java/jdk1.8.0_131/jre</span><br><span class="line">export CLASSPATH=.:$CLASSPATH:$JAVA_HOME/lib:$JRE_HOME/lib</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br></pre></td></tr></table></figure></p>
<p>e) 使配置生效<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>f) 验证安装成功</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-b151be02a229871c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5 id="3-hadoop安装"><a href="#3-hadoop安装" class="headerlink" title="3. hadoop安装"></a>3. hadoop安装</h5><p>a) 创建文件夹<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /export/server</span><br></pre></td></tr></table></figure></p>
<p>b) 同jdk中将安装包上传<br>c) 解压<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf  hadoop-2.7.0.tar.gz</span><br><span class="line">mv hadoop-2.7.0 hadoop</span><br><span class="line"></span><br><span class="line">// 删除hadoop-2.7.0.tar.gz文件</span><br><span class="line">rm –rf hadoop-2.7.0.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>d) 创建tmp文件夹<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /export/server/hadoop</span><br><span class="line">mkdir tmp</span><br></pre></td></tr></table></figure></p>
<p>e) 配置环境变量<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">// 将以下数据加入到文件末尾</span><br><span class="line">export HADOOP_INSTALL=/export/server/hadoop  </span><br><span class="line">export PATH=$&#123;HADOOP_INSTALL&#125;/bin:$&#123;HADOOP_INSTALL&#125;/sbin$&#123;PATH&#125;  </span><br><span class="line">export HADOOP_MAPRED_HOME=$&#123;HADOOP_INSTALL&#125;  </span><br><span class="line">export HADOOP_COMMON_HOME=$&#123;HADOOP_INSTALL&#125;  </span><br><span class="line">export HADOOP_HDFS_HOME=$&#123;HADOOP_INSTALL&#125;  </span><br><span class="line">export YARN_HOME=$&#123;HADOOP_INSTALLL&#125;  </span><br><span class="line">export HADOOP_COMMON_LIB_NATIVE_DIR=$&#123;HADOOP_INSTALL&#125;/lib/natvie    </span><br><span class="line">export HADOOP_OPTS=&quot;-Djava.library.path=$&#123;HADOOP_INSTALL&#125;/lib:$&#123;HADOOP_INSTALL&#125;/lib/native&quot;</span><br></pre></td></tr></table></figure></p>
<p>f) 重启”/etc/profile”使环境变量生效<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>g)配置hadoop<br>g1) 设置hadoop-env.sh和yarn-env.sh中的java环境变量<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /export/server/hadoop/etc/hadoop/</span><br><span class="line">vi hadoop-env.sh</span><br><span class="line"></span><br><span class="line">// 修改JAVA_HOME</span><br><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_131</span><br><span class="line">export HADOOP_CONF_DIR=/export/server/hadoop/etc/hadoop</span><br></pre></td></tr></table></figure></p>
<p>g2) 配置core-site.xml文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;/export/server/hadoop/tmp&lt;/value&gt;</span><br><span class="line">  &lt;description&gt;A base for other temporary directories.&lt;/description&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  &lt;name&gt;fs.default.name&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;hdfs://Master.Hadoop:9000&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>g3) 配置hdfs-site.xml文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;file:///export/server/hadoop/dfs/name&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property&gt;  </span><br><span class="line">     &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;file:///export/server/hadoop/dfs/data&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property&gt;</span><br><span class="line">     &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">     &lt;value&gt;1&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.nameservices&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hadoop-cluster1&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">	</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:50090&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">	</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>g4) 配置mapred-site.xml文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">      &lt;final&gt;true&lt;/final&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.jobtracker.http.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:50030&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:10020&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:19888&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;mapred.job.tracker&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;http://Master.Hadoop:9001&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>g5) 配置yarn-site.xml文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:8032&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:8030&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:8031&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.admin.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:8033&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;yarn.resourcemanager.webapp.address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;Master.Hadoop:8088&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<h5 id="4-主机名配置"><a href="#4-主机名配置" class="headerlink" title="4. 主机名配置"></a>4. 主机名配置</h5><p>前面三步基本已经安装好一个我们需要的模板系统，接下来就可以进行复制粘贴直接得到另外两个系统了。并对三个虚拟机的主机名作下更改。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname master.hadoop</span><br></pre></td></tr></table></figure></p>
<p>配置好后就需要对三者中的hosts文件进行配置：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line">// 将以下数据复制进入各个主机中</span><br><span class="line">192.168.44.133    master.hadoop</span><br><span class="line">192.168.44.134    slave1.hadoop</span><br><span class="line">192.168.44.135    slave2.hadoop</span><br></pre></td></tr></table></figure></p>
<p>使用以下指令对master主机中进行测试，可使用类似指令在slave主机测试<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping slave1.hadoop</span><br><span class="line">ping slave2.hadoop</span><br></pre></td></tr></table></figure></p>
<p>#####5. 配置Master无密码登录所有Salve</p>
<h6 id="5-1-Master中的配置"><a href="#5-1-Master中的配置" class="headerlink" title="5.1 Master中的配置"></a>5.1 Master中的配置</h6><p>a) 输入以下指令生成ssh<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">// 会生成两个文件，放到默认的/root/.ssh/文件夹中</span><br></pre></td></tr></table></figure></p>
<p>b) 把id_rsa.pub追加到授权的key里面去<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p>
<p>c) 修改文件”authorized_keys”权限<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p>
<p>d) 设置SSH配置<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">// 以下三项修改成以下配置</span><br><span class="line"></span><br><span class="line">RSAAuthentication yes # 启用 RSA 认证</span><br><span class="line"></span><br><span class="line">PubkeyAuthentication yes # 启用公钥私钥配对认证方式</span><br><span class="line"></span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys # 公钥文件路径（和上面生成的文件同）</span><br></pre></td></tr></table></figure></p>
<p>e) 重启ssh服务<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure></p>
<p>f) 把公钥复制所有的Slave机器上<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/id_rsa.pub root@192.168.44.134:~/</span><br><span class="line">scp ~/.ssh/id_rsa.pub root@192.168.44.135:~/</span><br></pre></td></tr></table></figure></p>
<h6 id="5-2-所有Slave中的配置"><a href="#5-2-所有Slave中的配置" class="headerlink" title="5.2 所有Slave中的配置"></a>5.2 所有Slave中的配置</h6><p>a) 在slave主机上创建.ssh文件夹<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.ssh</span><br><span class="line">// 修改权限</span><br><span class="line">chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure></p>
<p>b) 追加到授权文件”authorized_keys”<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">// 修改权限</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p>
<p>c) 删除无用.pub文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm –r ~/id_rsa.pub</span><br></pre></td></tr></table></figure></p>
<p>d) 在master主机下进行测试<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh 192.168.1.125</span><br><span class="line">ssh 192.168.1.124</span><br><span class="line">// 如果能够分别无密码登陆slave1, slave2主机，则成功配置</span><br></pre></td></tr></table></figure></p>
<h5 id="6-配置Hadoop的集群"><a href="#6-配置Hadoop的集群" class="headerlink" title="6. 配置Hadoop的集群"></a>6. 配置Hadoop的集群</h5><p>a) 修改Master主机上的slaves文件<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/hadoop/etc/hadoop</span><br><span class="line">vi slaves</span><br><span class="line"></span><br><span class="line">// 将文件内容修改为</span><br><span class="line">slave1.hadoop</span><br><span class="line">slave2.hadoop</span><br></pre></td></tr></table></figure></p>
<p>b) 格式化HDFS文件系统<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 在Master主机上输入以下指令</span><br><span class="line">hadoop namenode -format</span><br></pre></td></tr></table></figure></p>
<p>c) 启动hadoop<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 关闭机器防火墙</span><br><span class="line">service iptables stop</span><br><span class="line"></span><br><span class="line">cd /usr/hadoop/sbin</span><br><span class="line">./start-all.sh</span><br><span class="line"></span><br><span class="line">// 更推荐的运行方式：</span><br><span class="line">cd /usr/hadoop/sbin</span><br><span class="line">./start-dfs.sh</span><br><span class="line">./start-yarn.sh</span><br></pre></td></tr></table></figure></p>
<p>效果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-d3f91afbf2d0f5e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>d) 验证hadoop</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 1. 直接在Master或Slave输入指令：</span><br><span class="line">jps</span><br></pre></td></tr></table></figure>
<p>Master:(端口号只供参考)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-b120e4e7b15e5813.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>Slave:(端口号只供参考)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-25e92d01f4e95408.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 2. 输入以下指令，效果图参考开篇贴出的</span><br><span class="line">hdfs dfsadmin -report</span><br></pre></td></tr></table></figure>
<p>e) 进入hadoop管理首页<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// CentOS7中iptables这个服务的配置文件没有了，采用了新的firewalld</span><br><span class="line">// 输入以下指令后，可以在真机浏览器上访问hadoop网页</span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">// 在真机浏览器中输入以下网页即可进入</span><br><span class="line">http://192.168.44.133:50070/dfshealth.html#tab-overview</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-c18ee51dc4dac68a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-05T08:24:13.000Z">2017-07-05</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/随笔/">随笔</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 minutes read (About 2547 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/05/详解Java中ThreadLocal的实现与应用/">详解Java中ThreadLocal的实现与应用</a>
            
        </h1>
        <div class="content">
            <p>从这个类的名字就能大体了解到类的作用，ThreadLocal可以分解为Thread和Local，前者就不多说了，后者的意思是局部，本地的意思，整个类名可以理解为：线程局部对象或线程本地变量。程序是运行在线程中的，所以，在整个运行过程中，在任何地方都可以获得这个线程的局部对象，ThreadLocal类型的变量是和线程相绑定的。</p>
<h3 id="1-ThreadLocal源码"><a href="#1-ThreadLocal源码" class="headerlink" title="1.ThreadLocal源码"></a>1.ThreadLocal源码</h3><p>先来看一下涉及到的类图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-ff2577459cce46a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public T get() &#123;&#125; // 获取ThreadLocal在当前线程中保存的变量副本</span><br><span class="line">public void set(T value) &#123;&#125; //用来设置当前线程中变量的副本</span><br><span class="line">private T setInitialValue()&#123;&#125; // 设置初始值</span><br><span class="line">protected T initialValue()&#123;&#125; //得到初始值，一般是用来在使用时进行重写的</span><br><span class="line">void createMap(Thread t, T firstValue) &#123;&#125;  // 在线程中对threadLocals成员变量赋值</span><br></pre></td></tr></table></figure>
<p>get方法的实现如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public T get() &#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    if (map != null) &#123;</span><br><span class="line">        ThreadLocalMap.Entry e = map.getEntry(this);</span><br><span class="line">        if (e != null) &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">            T result = (T)e.value;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>get方法首先取得当前线程，然后通过getMap(t)方法获取到一个map，map的类型为ThreadLocalMap。然后接着下面获取到&lt;key,value&gt;键值对，注意这里获取键值对传进去的是this，而不是当前线程t。如果获取成功，则返回value值。如果map为空，则调用setInitialValue方法返回value。<br>接下来看一下getMap方法的源码：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap getMap(Thread t) &#123;</span><br><span class="line">        return t.threadLocals;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>在getMap中，是调用当期线程t，返回当前线程t中的一个成员变量threadLocals。 那就看一下Thread类是的threadLocals是什么。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal.ThreadLocalMap threadLocals = null;</span><br></pre></td></tr></table></figure></p>
<p>　实际上就是一个ThreadLocalMap，这个类型是ThreadLocal类的一个内部类，我们继续取看ThreadLocalMap的实现.<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">static class ThreadLocalMap &#123;</span><br><span class="line">        static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">            /** The value associated with this ThreadLocal. */</span><br><span class="line">            Object value;</span><br><span class="line"></span><br><span class="line">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">                super(k);</span><br><span class="line">                value = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里只贴出部份源码，熟悉HashMap源码的同学很快就会反映到这和HashMap的实现非常类似，在这里我就暂且可以将ThreadLocalMap理解为一个Map，即键值对形式的数据结构。</p>
<p>然后看一下setInitialValue方法的具体实现：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private T setInitialValue() &#123;</span><br><span class="line">       T value = initialValue();</span><br><span class="line">       Thread t = Thread.currentThread();</span><br><span class="line">       ThreadLocalMap map = getMap(t);</span><br><span class="line">       if (map != null)</span><br><span class="line">           map.set(this, value);</span><br><span class="line">       else</span><br><span class="line">           createMap(t, value);</span><br><span class="line">       return value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   void createMap(Thread t, T firstValue) &#123;</span><br><span class="line">       t.threadLocals = new ThreadLocalMap(this, firstValue);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  protected T initialValue() &#123;</span><br><span class="line">       return null;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>很容易了解，就是如果map不为空，就设置键值对。如果为空，就创建Map。在createMap方法里面以this(即ThreadLocal类型的变量)为值，以变量为键进行存储，即存储在当前线程中的threadLocals里面。同时源码中initialValue方法返回的是一个空值，所以我们在实际实用时为了防止空指针异常，在调用get方法前要么对initialValue方法进行重写，要么先调用set方法进行初始值的显示设置。下面看看set方法的源码：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void set(T value) &#123;</span><br><span class="line">        Thread t = Thread.currentThread();</span><br><span class="line">        ThreadLocalMap map = getMap(t);</span><br><span class="line">        if (map != null)</span><br><span class="line">            map.set(this, value);</span><br><span class="line">        else</span><br><span class="line">            createMap(t, value);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>有了上面的分析，set方法还是很容易理解的。<br>现在对ThreadLocal是如何为每个线程创建变量的副本的作一个小的总结：</p>
<p>　　首先，在每个线程Thread内部有一个ThreadLocal.ThreadLocalMap类型的成员变量threadLocals，这个threadLocals就是用来存储实际的变量副本的，键值为当前ThreadLocal变量，value为变量副本（即T类型的变量）。</p>
<p>　　初始时，在Thread里面，threadLocals为空，当通过ThreadLocal变量调用get()方法或者set()方法，就会对Thread类中的threadLocals进行初始化，并且以当前ThreadLocal变量为键值，以ThreadLocal要保存的副本变量为value，存到threadLocals。</p>
<p>　　然后在当前线程里面，如果要使用副本变量，就可以通过get方法在threadLocals里面查找。</p>
<h3 id="2-实例"><a href="#2-实例" class="headerlink" title="2.实例"></a>2.实例</h3><h5 id="2-1-实例一-在调用get前先要使用set进行设置"><a href="#2-1-实例一-在调用get前先要使用set进行设置" class="headerlink" title="2.1 实例一:在调用get前先要使用set进行设置"></a>2.1 实例一:在调用get前先要使用set进行设置</h5><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.hust.hebh.concurrency;</span><br><span class="line"></span><br><span class="line">public class ThreadLocalTest &#123;</span><br><span class="line">	ThreadLocal&lt;Long&gt; longLocal = new ThreadLocal&lt;Long&gt;();</span><br><span class="line">	ThreadLocal&lt;String&gt; stringLocal = new ThreadLocal&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	public void set() &#123;</span><br><span class="line">		longLocal.set(Thread.currentThread().getId());</span><br><span class="line">		stringLocal.set(Thread.currentThread().getName());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public long getLong() &#123;</span><br><span class="line">		return longLocal.get();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public String getString() &#123;</span><br><span class="line">		return stringLocal.get();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		final ThreadLocalTest test = new ThreadLocalTest();		</span><br><span class="line">		</span><br><span class="line">		test.set();</span><br><span class="line">		System.out.println(test.getLong());</span><br><span class="line">		System.out.println(test.getString());	</span><br><span class="line">		</span><br><span class="line">		Thread thread1 = new Thread()&#123;</span><br><span class="line">			public void run() &#123;</span><br><span class="line">				test.set();</span><br><span class="line">				System.out.println(test.getLong());</span><br><span class="line">				System.out.println(test.getString());</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;;</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread1.join();</span><br><span class="line">		</span><br><span class="line">		System.out.println(test.getLong());</span><br><span class="line">		System.out.println(test.getString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从这段代码的输出结果可以看出，在main线程中和thread1线程中，longLocal保存的副本值和stringLocal保存的副本值都不一样。最后一次在main线程再次打印副本值是为了证明在main线程中和thread1线程中的副本值确实是不同的。</p>
<p>　　总结一下：</p>
<p>　　1）实际的通过ThreadLocal创建的副本是存储在每个线程自己的threadLocals中的；</p>
<p>　　2）为何threadLocals的类型ThreadLocalMap的键值为ThreadLocal对象，因为每个线程中可有多个threadLocal变量，就像上面代码中的longLocal和stringLocal；</p>
<p>　　3）在进行get之前，必须先set，否则会报空指针异常；</p>
<p>　　    如果想在get之前不需要调用set就能正常访问的话，必须重写initialValue()方法。</p>
<h5 id="2-2-实例二-重写initialValue方法"><a href="#2-2-实例二-重写initialValue方法" class="headerlink" title="2.2 实例二,重写initialValue方法"></a>2.2 实例二,重写initialValue方法</h5><blockquote>
<p>在上面的代码分析过程中，我们发现如果没有先set的话，即在map中查找不到对应的存储，则会通过调用setInitialValue方法返回i，而在setInitialValue方法中，有一个语句是T value = initialValue()， 而默认情况下，initialValue方法返回的是null。下面看看如何对initialValue方法进行重写</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package com.hust.hebh.concurrency;</span><br><span class="line"></span><br><span class="line">public class ThreadLocalDemo &#123;</span><br><span class="line">	ThreadLocal&lt;Long&gt; longLocal = new ThreadLocal&lt;Long&gt;()&#123;</span><br><span class="line">		protected Long initialValue() &#123;</span><br><span class="line">			return Thread.currentThread().getId();</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">	ThreadLocal&lt;String&gt; stringLocal = new ThreadLocal&lt;String&gt;()&#123;;</span><br><span class="line">		protected String initialValue() &#123;</span><br><span class="line">			return Thread.currentThread().getName();</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	public void set() &#123;</span><br><span class="line">		longLocal.set(Thread.currentThread().getId());</span><br><span class="line">		stringLocal.set(Thread.currentThread().getName());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public long getLong() &#123;</span><br><span class="line">		return longLocal.get();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public String getString() &#123;</span><br><span class="line">		return stringLocal.get();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		final ThreadLocalDemo test = new ThreadLocalDemo();</span><br><span class="line"></span><br><span class="line">		//test.set();</span><br><span class="line">		System.out.println(test.getLong());</span><br><span class="line">		System.out.println(test.getString());	</span><br><span class="line">		</span><br><span class="line">		Thread thread1 = new Thread()&#123;</span><br><span class="line">			public void run() &#123;</span><br><span class="line">				//test.set();</span><br><span class="line">				System.out.println(test.getLong());</span><br><span class="line">				System.out.println(test.getString());</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;;</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread1.join();</span><br><span class="line">		</span><br><span class="line">		System.out.println(test.getLong());</span><br><span class="line">		System.out.println(test.getString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过对对initialValue方法进行重写在不进行set的情况下就可以实现和实例一相同的效果。</p>
<h3 id="3-ThreadLocal的应用场景"><a href="#3-ThreadLocal的应用场景" class="headerlink" title="3. ThreadLocal的应用场景"></a>3. ThreadLocal的应用场景</h3><blockquote>
<p>最常见的ThreadLocal使用场景为 用来解决 数据库连接、Session管理等。</p>
</blockquote>
<p>下面来看一个hibernate中典型的ThreadLocal的应用：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private static final ThreadLocal threadSession = new ThreadLocal();  </span><br><span class="line">  </span><br><span class="line">public static Session getSession() throws InfrastructureException &#123;  </span><br><span class="line">    Session s = (Session) threadSession.get();  </span><br><span class="line">    try &#123;  </span><br><span class="line">        if (s == null) &#123;  </span><br><span class="line">            s = getSessionFactory().openSession();  </span><br><span class="line">            threadSession.set(s);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; catch (HibernateException ex) &#123;  </span><br><span class="line">        throw new InfrastructureException(ex);  </span><br><span class="line">    &#125;  </span><br><span class="line">    return s;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到在getSession()方法中，首先判断当前线程中有没有放进去session，如果还没有，那么通过sessionFactory().openSession()来创建一个session，再将session set到线程中，实际是放到当前线程的ThreadLocalMap这个map中，这时，对于这个session的唯一引用就是当前线程中的那个ThreadLocalMap（下面会讲到），而threadSession作为这个值的key，要取得这个session可以通过threadSession.get()来得到，里面执行的操作实际是先取得当前线程中的ThreadLocalMap，然后将threadSession作为key将对应的值取出。这个session相当于线程的私有变量，而不是public的。<br>显然，其他线程中是取不到这个session的，他们也只能取到自己的ThreadLocalMap中的东西。要是session是多个线程共享使用的，那还不乱套了。<br>试想如果不用ThreadLocal怎么来实现呢？可能就要在action中创建session，然后把session一个个传到service和dao中，这可够麻烦的。或者可以自己定义一个静态的map，将当前thread作为key，创建的session作为值，put到map中，应该也行，这也是一般人的想法，但事实上，ThreadLocal的实现刚好相反，它是在每个线程中有一个map，而将ThreadLocal实例作为key，这样每个map中的项数很少，而且当线程销毁时相应的东西也一起销毁了，不知道除了这些还有什么其他的好处。 </p>
<p>总之，ThreadLocal不是用来解决对象共享访问问题的，而主要是提供了保持对象的方法和避免参数传递的方便的对象访问方式。归纳了两点：<br>1。每个线程中都有一个自己的ThreadLocalMap类对象，可以将线程自己的对象保持到其中，各管各的，线程可以正确的访问到自己的对象。<br>2。将一个共用的ThreadLocal静态实例作为key，将不同对象的引用保存到不同线程的ThreadLocalMap中，然后在线程执行的各处通过这个静态ThreadLocal实例的get()方法取得自己线程保存的那个对象，避免了将这个对象作为参数传递的麻烦。 </p>
<p>当然如果要把本来线程共享的对象通过ThreadLocal.set()放到线程中也可以，可以实现避免参数传递的访问方式，但是要注意get()到的是那同一个共享对象，并发访问问题要靠其他手段来解决。但一般来说线程共享的对象通过设置为某类的静态变量就可以实现方便的访问了，似乎没必要放到线程中。 </p>
<p>ThreadLocal的应用场合，我觉得最适合的是按线程多实例（每个线程对应一个实例）的对象的访问，并且这个对象很多地方都要用到。</p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-05T08:24:01.000Z">2017-07-05</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/随笔/">随笔</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    34 minutes read (About 5147 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/05/详解Java中ThreadPool的使用/">详解Java中ThreadPool的使用</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p> 线程池就是限制系统中执行线程的数量。我们可以根据系统的环境情况，可以自动或手动设置线程数量，达到运行的最佳效果；少了浪费了系统资源，多了造成系统拥挤效率不高。用线程池控制线程数量，其他线程排队等候。一个任务执行完毕，再从队列的中取最前面的任务开始执行。若队列中没有等待进程，线程池的这一资源处于等待。当一个新任务需要运行时，如果线程池中有等待的工作线程，就可以开始运行了；否则进入等待队列。</p>
</blockquote>
<p>为什么要用线程池:</p>
<ul>
<li>1.减少了创建和销毁线程的次数，每个工作线程都可以被重复利用，可执行多个任务。</li>
<li>2.可以根据系统的承受能力，调整线程池中工作线线程的数目，防止因为消耗过多的内存，而把服务器累趴下(每个线程需要大约1MB内存，线程开的越多，消耗的内存也就越大，最后死机)。</li>
</ul>
<h3 id="1-线程池继承体系"><a href="#1-线程池继承体系" class="headerlink" title="1.线程池继承体系"></a>1.线程池继承体系</h3><p>如下图所示，Java里面线程池的顶级接口是Executor，但是严格意义上讲Executor并不是一个线程池，而只是一个执行线程的工具。真正的线程池接口是ExecutorService。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-bdda6586fda92ceb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="2-Executors"><a href="#2-Executors" class="headerlink" title="2.Executors"></a>2.Executors</h3><blockquote>
<p>要配置一个线程池是比较复杂的，尤其是对于线程池的原理不是很清楚的情况下，很有可能配置的线程池不是较优的，因此在Executors类里面提供了一些静态工厂，生成一些常用的线程池。</p>
</blockquote>
<h5 id="2-1-newSingleThreadExecutor"><a href="#2-1-newSingleThreadExecutor" class="headerlink" title="2.1  newSingleThreadExecutor"></a>2.1  newSingleThreadExecutor</h5><blockquote>
<p>创建一个单线程的线程池。这个线程池只有一个线程在工作，也就是相当于单线程串行执行所有任务。如果这个唯一的线程因为异常结束，那么会有一个新的线程来替代它。此线程池保证所有任务的执行顺序按照任务的提交顺序执行。</p>
</blockquote>
<p><strong>源码：</strong><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newSingleThreadExecutor() &#123;</span><br><span class="line">       return new FinalizableDelegatedExecutorService</span><br><span class="line">           (new ThreadPoolExecutor(1, 1,</span><br><span class="line">                                   0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                                   new LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>实例</strong>：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public classMyThread extends Thread &#123;</span><br><span class="line">    @Override</span><br><span class="line">    publicvoid run() &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + &quot;正在执行。。。&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">publicclassTestSingleThreadExecutor &#123;</span><br><span class="line">    publicstaticvoid main(String[] args) &#123;</span><br><span class="line">        //创建一个可重用固定线程数的线程池</span><br><span class="line">        ExecutorService pool = Executors. newSingleThreadExecutor();</span><br><span class="line">        //创建实现了Runnable接口对象，Thread对象当然也实现了Runnable接口</span><br><span class="line">        Thread t1 = new MyThread();</span><br><span class="line">        Thread t2 = new MyThread();</span><br><span class="line">        Thread t3 = new MyThread();</span><br><span class="line">        Thread t4 = new MyThread();</span><br><span class="line">        Thread t5 = new MyThread();</span><br><span class="line">        //将线程放入池中进行执行</span><br><span class="line">        pool.execute(t1);</span><br><span class="line">        pool.execute(t2);</span><br><span class="line">        pool.execute(t3);</span><br><span class="line">        pool.execute(t4);</span><br><span class="line">        pool.execute(t5);</span><br><span class="line">        //关闭线程池</span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br></pre></td></tr></table></figure></p>
<h5 id="2-2-newFixedThreadPool"><a href="#2-2-newFixedThreadPool" class="headerlink" title="2.2 newFixedThreadPool"></a>2.2 newFixedThreadPool</h5><blockquote>
<p>创建固定大小的线程池。每次提交一个任务就创建一个线程，直到线程达到线程池的最大大小。线程池的大小一旦达到最大值就会保持不变，如果某个线程因为执行异常而结束，那么线程池会补充一个新线程。</p>
</blockquote>
<p><strong>源码：</strong><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newFixedThreadPool(int nThreads) &#123;</span><br><span class="line">     return new ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                   0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                                   new LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>实例</strong>：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">publicclass TestFixedThreadPool &#123;</span><br><span class="line">    publicstaticvoid main(String[] args) &#123;</span><br><span class="line">        //创建一个可重用固定线程数的线程池</span><br><span class="line">        ExecutorService pool = Executors.newFixedThreadPool(2);</span><br><span class="line">        //创建实现了Runnable接口对象，Thread对象当然也实现了Runnable接口</span><br><span class="line">        Thread t1 = new MyThread();</span><br><span class="line">        Thread t2 = new MyThread();</span><br><span class="line">        Thread t3 = new MyThread();</span><br><span class="line">        Thread t4 = new MyThread();</span><br><span class="line">        Thread t5 = new MyThread();</span><br><span class="line">        //将线程放入池中进行执行</span><br><span class="line">        pool.execute(t1);</span><br><span class="line">        pool.execute(t2);</span><br><span class="line">        pool.execute(t3);</span><br><span class="line">        pool.execute(t4);</span><br><span class="line">        pool.execute(t5);</span><br><span class="line">        //关闭线程池</span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-2正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-2正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br></pre></td></tr></table></figure></p>
<h5 id="2-3-newCachedThreadPool"><a href="#2-3-newCachedThreadPool" class="headerlink" title="2.3 newCachedThreadPool"></a>2.3 newCachedThreadPool</h5><blockquote>
<p>创建一个可缓存的线程池。如果线程池的大小超过了处理任务所需要的线程，那么就会回收部分空闲（60秒不执行任务）的线程，当任务数增加时，此线程池又可以<a href="http://lib.csdn.net/base/aiplanning" target="_blank" rel="noopener">智能</a>的添加新线程来处理任务。此线程池不会对线程池大小做限制，线程池大小完全依赖于<a href="http://lib.csdn.net/base/operatingsystem" target="_blank" rel="noopener">操作系统</a>（或者说JVM）能够创建的最大线程大小。</p>
</blockquote>
<p><strong>源码：</strong><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newCachedThreadPool() &#123;</span><br><span class="line">     return new ThreadPoolExecutor(0, Integer.MAX_VALUE,</span><br><span class="line">                                   60L, TimeUnit.SECONDS,</span><br><span class="line">                                   new SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>实例</strong>：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">publicclass TestCachedThreadPool &#123;</span><br><span class="line">    publicstaticvoid main(String[] args) &#123;</span><br><span class="line">        //创建一个可重用固定线程数的线程池</span><br><span class="line">        ExecutorService pool = Executors.newCachedThreadPool();</span><br><span class="line">        //创建实现了Runnable接口对象，Thread对象当然也实现了Runnable接口</span><br><span class="line">        Thread t1 = new MyThread();</span><br><span class="line">        Thread t2 = new MyThread();</span><br><span class="line">        Thread t3 = new MyThread();</span><br><span class="line">        Thread t4 = new MyThread();</span><br><span class="line">        Thread t5 = new MyThread();</span><br><span class="line">        //将线程放入池中进行执行</span><br><span class="line">        pool.execute(t1);</span><br><span class="line">        pool.execute(t2);</span><br><span class="line">        pool.execute(t3);</span><br><span class="line">        pool.execute(t4);</span><br><span class="line">        pool.execute(t5);</span><br><span class="line">        //关闭线程池</span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pool-1-thread-2正在执行。。。</span><br><span class="line">pool-1-thread-4正在执行。。。</span><br><span class="line">pool-1-thread-3正在执行。。。</span><br><span class="line">pool-1-thread-1正在执行。。。</span><br><span class="line">pool-1-thread-5正在执行。。。</span><br></pre></td></tr></table></figure></p>
<h5 id="2-4-newScheduledThreadPool"><a href="#2-4-newScheduledThreadPool" class="headerlink" title="2.4 newScheduledThreadPool"></a>2.4 newScheduledThreadPool</h5><blockquote>
<p>创建一个大小无限的线程池。此线程池支持定时以及周期性执行任务的需求。</p>
</blockquote>
<p><strong>源码：</strong><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123;</span><br><span class="line">    return new ScheduledThreadPoolExecutor(corePoolSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>实例</strong>：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">publicclass TestScheduledThreadPoolExecutor &#123;</span><br><span class="line">    publicstaticvoid main(String[] args) &#123;</span><br><span class="line">        ScheduledThreadPoolExecutor exec = new ScheduledThreadPoolExecutor(1);</span><br><span class="line">        exec.scheduleAtFixedRate(new Runnable() &#123;//每隔一段时间就触发异常</span><br><span class="line">                      @Override</span><br><span class="line">                      publicvoid run() &#123;</span><br><span class="line">                           //throw new RuntimeException();</span><br><span class="line">                           System.out.println(&quot;================&quot;);</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;, 1000, 5000, TimeUnit.MILLISECONDS);</span><br><span class="line">        exec.scheduleAtFixedRate(new Runnable() &#123;//每隔一段时间打印系统时间，证明两者是互不影响的</span><br><span class="line">                      @Override</span><br><span class="line">                      publicvoid run() &#123;</span><br><span class="line">                           System.out.println(System.nanoTime());</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;, 1000, 2000, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">================</span><br><span class="line">8384644549516</span><br><span class="line">8386643829034</span><br><span class="line">8388643830710</span><br><span class="line">================</span><br><span class="line">8390643851383</span><br><span class="line">8392643879319</span><br><span class="line">8400643939383</span><br></pre></td></tr></table></figure></p>
<h3 id="3-ThreadPoolExecutor"><a href="#3-ThreadPoolExecutor" class="headerlink" title="3.ThreadPoolExecutor"></a>3.ThreadPoolExecutor</h3><blockquote>
<p>从上面Executors类创建几种线程池的源码中可以发现，底层调用了ThreadPoolExecutor类的构造方法。下面就具体的看一看这个类的相关源码。</p>
</blockquote>
<h5 id="3-1-构造方法"><a href="#3-1-构造方法" class="headerlink" title="3.1 构造方法"></a>3.1 构造方法</h5><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 用给定的参数创建一个线程池</span><br><span class="line">    *</span><br><span class="line">    * @param corePoolSize 池中所保存的线程数，包括空闲线程。</span><br><span class="line">    * @param maximumPoolSize 池中允许的最大线程数。</span><br><span class="line">    * @param keepAliveTime 当线程数大于核心时，此为终止前多余的空闲线 程等待新任务的最长时间。</span><br><span class="line">    * @param unit 参数的时间单位。</span><br><span class="line">    * @param workQueue 执行前用于保持任务的队列。此队列仅保持由 execute方法提交的Runnable任务。</span><br><span class="line">    * @param threadFactory 执行程序创建新线程时使用的工厂。</span><br><span class="line">    * @param handler 由于超出线程范围和队列容量而使执行被阻塞时所使用的处理程序。</span><br><span class="line">    */</span><br><span class="line">   public ThreadPoolExecutor(int corePoolSize,</span><br><span class="line">                             int maximumPoolSize,</span><br><span class="line">                             long keepAliveTime,</span><br><span class="line">                             TimeUnit unit,</span><br><span class="line">                             BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">                             ThreadFactory threadFactory,</span><br><span class="line">                             RejectedExecutionHandler handler) &#123;</span><br><span class="line">       if (corePoolSize &lt; 0 ||</span><br><span class="line">           maximumPoolSize &lt;= 0 ||</span><br><span class="line">           maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">           keepAliveTime &lt; 0)</span><br><span class="line">           throw new IllegalArgumentException();</span><br><span class="line">       if (workQueue == null || threadFactory == null || handler == null)</span><br><span class="line">           throw new NullPointerException();</span><br><span class="line">       this.corePoolSize = corePoolSize;</span><br><span class="line">       this.maximumPoolSize = maximumPoolSize;</span><br><span class="line">       this.workQueue = workQueue;</span><br><span class="line">       this.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">       this.threadFactory = threadFactory;</span><br><span class="line">       this.handler = handler;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-2-execute方法"><a href="#3-2-execute方法" class="headerlink" title="3.2.execute方法"></a>3.2.execute方法</h5><blockquote>
<p>execute方法里面的代码逻辑对应着用户提交一个线程时的执行流程，如下流程图。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-f50097d892bc4910.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>源码：</strong><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public void execute(Runnable command) &#123;</span><br><span class="line">        if (command == null)</span><br><span class="line">            throw new NullPointerException();</span><br><span class="line">        int c = ctl.get();</span><br><span class="line">        if (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">            if (addWorker(command, true))</span><br><span class="line">                return;</span><br><span class="line">            c = ctl.get();</span><br><span class="line">        &#125;</span><br><span class="line">        if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">            int recheck = ctl.get();</span><br><span class="line">            if (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">                reject(command);</span><br><span class="line">            else if (workerCountOf(recheck) == 0)</span><br><span class="line">                addWorker(null, false);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (!addWorker(command, false))</span><br><span class="line">            reject(command);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="3-3-BlockingQueue-参数"><a href="#3-3-BlockingQueue-参数" class="headerlink" title="3.3 BlockingQueue 参数"></a>3.3 BlockingQueue<runnable> 参数</runnable></h5><blockquote>
<p>线程池的实现，队列起着至关重要的作用。它也是ThreadPoolExecutor构造方法里面的参数之间。从上面的excute执行逻辑知道当核心线程已满，如果等待队列未满，我们就可以把线程任务放到队列中去，当线程池中有空闲线程就会执行该任务。</p>
</blockquote>
<h6 id="3-3-1-类图："><a href="#3-3-1-类图：" class="headerlink" title="3.3.1 类图："></a>3.3.1 类图：</h6><p><img src="http://upload-images.jianshu.io/upload_images/5990755-dfc02c89683b3225.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ArrayBlockingQueue－－声明时就确定大小的队列，fifo方式。（方法基本和接口一致，没有特别要说明的内容）</span><br><span class="line">LinkedBlockingQueue－－链表实现的queue－remove效率会高一些</span><br><span class="line">PriorityBlockingQueue－－优先级队列</span><br><span class="line">SynchronousQueue--阻塞队列，必须拿走一个才能放进来一个，也就是最多只有一个～</span><br><span class="line">DelayQuque－－就是放进去的内容，延迟时间到了后才可以获得</span><br><span class="line">LinkedBlockDeque－－双端队列 ：offerFirst／offerLast，pollFirst/pollLast</span><br><span class="line">LinkedTransferQueue--类似LinkedUnBlockedQueue，其实就是transfer方法有人再等待队列内容就直接给他这个元素，没人在等就放在队列里面。也就是效率会更高。</span><br></pre></td></tr></table></figure></p>
<h6 id="3-3-2-排队的三种通用策略："><a href="#3-3-2-排队的三种通用策略：" class="headerlink" title="3.3.2 排队的三种通用策略："></a>3.3.2 排队的三种通用策略：</h6><ul>
<li>直接提交。工作队列的默认选项是 SynchronousQueue，它将任务直接提交给线程而不保持它们。在此，如果不存在可用于立即运行任务的线程，则试图把任务加入队列将失败，因此会构造一个新的线程。此策略可以避免在处理可能具有内部依赖性的请求集时出现锁。直接提交通常要求无界 maximumPoolSizes 以避免拒绝新提交的任务。当命令以超过队列所能处理的平均数连续到达时，此策略允许无界线程具有增长的可能性。</li>
<li>无界队列。使用无界队列（例如，不具有预定义容量的 LinkedBlockingQueue）将导致在所有 corePoolSize 线程都忙时新任务在队列中等待。这样，创建的线程就不会超过 corePoolSize。（因此，maximumPoolSize的值也就无效了。）当每个任务完全独立于其他任务，即任务执行互不影响时，适合于使用无界队列；例如，在 Web页服务器中。这种排队可用于处理瞬态突发请求，当命令以超过队列所能处理的平均数连续到达时，此策略允许无界线程具有增长的可能性。</li>
<li>有界队列。当使用有限的 maximumPoolSizes时，有界队列（如 ArrayBlockingQueue）有助于防止资源耗尽，但是可能较难调整和控制。队列大小和最大池大小可能需要相互折衷：使用大型队列和小型池可以最大限度地降低 CPU 使用率、操作系统资源和上下文切换开销，但是可能导致人工降低吞吐量。如果任务频繁阻塞（例如，如果它们是 I/O边界），则系统可能为超过您许可的更多线程安排时间。使用小型队列通常要求较大的池大小，CPU使用率较高，但是可能遇到不可接受的调度开销，这样也会降低吞吐量。  </li>
</ul>
<h6 id="3-3-3-BlockingQueue的选择。"><a href="#3-3-3-BlockingQueue的选择。" class="headerlink" title="3.3.3 BlockingQueue的选择。"></a>3.3.3 BlockingQueue的选择。</h6><ul>
<li><p>例子一：使用直接提交策略，也即SynchronousQueue。<br>首先SynchronousQueue是无界的，也就是说他存数任务的能力是没有限制的，但是由于该Queue本身的特性，在某次添加元素后必须等待其他线程取走后才能继续添加。在这里不是核心线程便是新创建的线程，但是我们试想一样下，下面的场景。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new ThreadPoolExecutor(</span><br><span class="line">  2, 3, 30, TimeUnit.SECONDS,</span><br><span class="line">  new SynchronousQueue&lt;Runnable&gt;(),</span><br><span class="line">  new RecorderThreadFactory(&quot;CookieRecorderPool&quot;),</span><br><span class="line">  new ThreadPoolExecutor.CallerRunsPolicy());</span><br></pre></td></tr></table></figure>
<p>当核心线程已经有2个正在运行.<br>此时继续来了一个任务（A），根据前面介绍的“如果运行的线程等于或多于 corePoolSize，则 Executor始终首选将请求加入队列，而不添加新的线程。”,所以A被添加到queue中。<br>又来了一个任务（B），且核心2个线程还没有忙完，OK，接下来首先尝试1中描述，但是由于使用的SynchronousQueue，所以一定无法加入进去。<br>此时便满足了上面提到的“如果无法将请求加入队列，则创建新的线程，除非创建此线程超出maximumPoolSize，在这种情况下，任务将被拒绝。”，所以必然会新建一个线程来运行这个任务。<br>暂时还可以，但是如果这三个任务都还没完成，连续来了两个任务，第一个添加入queue中，后一个呢？queue中无法插入，而线程数达到了maximumPoolSize，所以只好执行异常策略了。<br>所以在使用SynchronousQueue通常要求maximumPoolSize是无界的，这样就可以避免上述情况发生（如果希望限制就直接使用有界队列）。对于使用SynchronousQueue的作用jdk中写的很清楚：此策略可以避免在处理可能具有内部依赖性的请求集时出现锁。<br>什么意思？如果你的任务A1，A2有内部关联，A1需要先运行，那么先提交A1，再提交A2，当使用SynchronousQueue我们可以保证，A1必定先被执行，在A1么有被执行前，A2不可能添加入queue中。</p>
</li>
<li><p>例子二：使用无界队列策略，即LinkedBlockingQueue<br>这个就拿newFixedThreadPool来说，根据前文提到的规则：<br>如果运行的线程少于 corePoolSize，则 Executor 始终首选添加新的线程，而不进行排队。那么当任务继续增加，会发生什么呢？<br>如果运行的线程等于或多于 corePoolSize，则 Executor 始终首选将请求加入队列，而不添加新的线程。OK，此时任务变加入队列之中了，那什么时候才会添加新线程呢？<br>如果无法将请求加入队列，则创建新的线程，除非创建此线程超出 maximumPoolSize，在这种情况下，任务将被拒绝。这里就很有意思了，可能会出现无法加入队列吗？不像SynchronousQueue那样有其自身的特点，对于无界队列来说，总是可以加入的（资源耗尽，当然另当别论）。换句说，永远也不会触发产生新的线程！corePoolSize大小的线程数会一直运行，忙完当前的，就从队列中拿任务开始运行。所以要防止任务疯长，比如任务运行的实行比较长，而添加任务的速度远远超过处理任务的时间，而且还不断增加，不一会儿就爆了。</p>
</li>
<li>例子三：有界队列，使用ArrayBlockingQueue。<br>这个是最为复杂的使用，所以JDK不推荐使用也有些道理。与上面的相比，最大的特点便是可以防止资源耗尽的情况发生。<br>举例来说，请看如下构造方法：<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new ThreadPoolExecutor(</span><br><span class="line">    2, 4, 30, TimeUnit.SECONDS,</span><br><span class="line">    new ArrayBlockingQueue&lt;Runnable&gt;(2),</span><br><span class="line">    new RecorderThreadFactory(&quot;CookieRecorderPool&quot;),</span><br><span class="line">    new ThreadPoolExecutor.CallerRunsPolicy());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>假设，所有的任务都永远无法执行完。<br>对于首先来的A,B来说直接运行，接下来，如果来了C,D，他们会被放到queue中，如果接下来再来E,F，则增加线程运行E，F。但是如果再来任务，队列无法再接受了，线程数也到达最大的限制了，所以就会使用拒绝策略来处理。</p>
<h5 id="3-4-keepAliveTime-参数"><a href="#3-4-keepAliveTime-参数" class="headerlink" title="3.4 keepAliveTime 参数"></a>3.4 keepAliveTime 参数</h5><blockquote>
<p>由上可知，ThreadPoolExecutor中额定的“工人”数量由corePoolSize决定，当任务数量超过额定工人数量时，将任务缓存在BlockingQueue之中，当发现如果连queue中也放不下时（可能是因为使用有界queue，也可能是使用SynchronousQueue），ThreadPoolExecutor会请求“老板”再派几个“工人”过来。</p>
</blockquote>
<p>接下来发生的事情有两种情况：</p>
<ul>
<li>任务不再过来了 - keepAliveTime</li>
<li>任务仍然继续过来 - RejectedExecutionHandler</li>
</ul>
<p>对于keepAliveTime参数，jdk中的解释是：当线程数大于核心时，此为终止前多余的空闲线程等待新任务的最长时间。</p>
<p>有点拗口，其实这个不难理解，在使用了“池”的应用中，大多都有类似的参数需要配置。比如数据库连接池，DBCP中的maxIdle，minIdle参数。</p>
<p>什么意思？接着上面的解释，后来向老板派来的工人始终是“借来的”，俗话说“有借就有还”，但这里的问题就是什么时候还了，如果借来的工人刚完成一个任务就还回去，后来发现任务还有，那岂不是又要去借？这一来一往，老板肯定头也大死了。</p>
<p>合理的策略：既然借了，那就多借一会儿。直到“某一段”时间后，发现再也用不到这些工人时，便可以还回去了。这里的某一段时间便是keepAliveTime的含义，TimeUnit为keepAliveTime值的度量。</p>
<p>总结：</p>
<p>keepAliveTime和maximumPoolSize及BlockingQueue的类型均有关系。如果BlockingQueue是无界的，那么永远不会触发maximumPoolSize，自然keepAliveTime也就没有了意义。</p>
<p>反之，如果核心数较小，有界BlockingQueue数值又较小，同时keepAliveTime又设的很小，如果任务频繁，那么系统就会频繁的申请回收线程。</p>
<h5 id="3-5-RejectedExecutionHandler"><a href="#3-5-RejectedExecutionHandler" class="headerlink" title="3.5  RejectedExecutionHandler"></a>3.5  RejectedExecutionHandler</h5><blockquote>
<p>即拒绝策略，当即使向老板借了工人，但是任务还是继续过来，还是忙不过来，这时整个队伍只好拒绝接受了。<br>RejectedExecutionHandler接口提供了对于拒绝任务的处理的自定方法的机会。在ThreadPoolExecutor中已经默认包含了4中策略，因为源码非常简单，这里直接贴出来。</p>
</blockquote>
<h6 id="3-5-1-CallerRunsPolicy"><a href="#3-5-1-CallerRunsPolicy" class="headerlink" title="3.5 .1 CallerRunsPolicy"></a>3.5 .1 CallerRunsPolicy</h6><blockquote>
<p>线程调用运行该任务的 execute 本身。此策略提供简单的反馈控制机制，能够减缓新任务的提交速度。</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static class CallerRunsPolicy implements RejectedExecutionHandler &#123;</span><br><span class="line">       /**</span><br><span class="line">        * Creates a &#123;@code CallerRunsPolicy&#125;.</span><br><span class="line">        */</span><br><span class="line">       public CallerRunsPolicy() &#123; &#125;</span><br><span class="line"></span><br><span class="line">       /**</span><br><span class="line">        * Executes task r in the caller&apos;s thread, unless the executor</span><br><span class="line">        * has been shut down, in which case the task is discarded.</span><br><span class="line">        *</span><br><span class="line">        * @param r the runnable task requested to be executed</span><br><span class="line">        * @param e the executor attempting to execute this task</span><br><span class="line">        */</span><br><span class="line">       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="line">           if (!e.isShutdown()) &#123;</span><br><span class="line">               r.run();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这个策略显然不想放弃执行任务。但是由于池中已经没有任何资源了，那么就直接使用调用该execute的线程本身来执行。</p>
<h6 id="3-5-2-AbortPolicy"><a href="#3-5-2-AbortPolicy" class="headerlink" title="3.5 .2 AbortPolicy"></a>3.5 .2 AbortPolicy</h6><blockquote>
<p>处理程序遭到拒绝将抛出运行时 RejectedExecutionException</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static class AbortPolicy implements RejectedExecutionHandler &#123;</span><br><span class="line">        /**</span><br><span class="line">         * Creates an &#123;@code AbortPolicy&#125;.</span><br><span class="line">         */</span><br><span class="line">        public AbortPolicy() &#123; &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * Always throws RejectedExecutionException.</span><br><span class="line">         *</span><br><span class="line">         * @param r the runnable task requested to be executed</span><br><span class="line">         * @param e the executor attempting to execute this task</span><br><span class="line">         * @throws RejectedExecutionException always</span><br><span class="line">         */</span><br><span class="line">        public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="line">            throw new RejectedExecutionException(&quot;Task &quot; + r.toString() +</span><br><span class="line">                                                 &quot; rejected from &quot; +</span><br><span class="line">                                                 e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p> 这种策略直接抛出异常，丢弃任务。</p>
<h6 id="3-5-3-DiscardPolicy"><a href="#3-5-3-DiscardPolicy" class="headerlink" title="3.5 .3  DiscardPolicy"></a>3.5 .3  DiscardPolicy</h6><blockquote>
<p>不能执行的任务将被删除</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public static class DiscardPolicy implements RejectedExecutionHandler &#123;</span><br><span class="line">      /**</span><br><span class="line">       * Creates a &#123;@code DiscardPolicy&#125;.</span><br><span class="line">       */</span><br><span class="line">      public DiscardPolicy() &#123; &#125;</span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">       * Does nothing, which has the effect of discarding task r.</span><br><span class="line">       *</span><br><span class="line">       * @param r the runnable task requested to be executed</span><br><span class="line">       * @param e the executor attempting to execute this task</span><br><span class="line">       */</span><br><span class="line">      public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p> 这种策略和AbortPolicy几乎一样，也是丢弃任务，只不过他不抛出异常。</p>
<h6 id="3-5-4-DiscardOldestPolicy"><a href="#3-5-4-DiscardOldestPolicy" class="headerlink" title="3.5 .4 DiscardOldestPolicy"></a>3.5 .4 DiscardOldestPolicy</h6><blockquote>
<p>如果执行程序尚未关闭，则位于工作队列头部的任务将被删除，然后重试执行程序（如果再次失败，则重复此过程）</p>
</blockquote>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static class DiscardOldestPolicy implements RejectedExecutionHandler &#123;</span><br><span class="line">     /**</span><br><span class="line">      * Creates a &#123;@code DiscardOldestPolicy&#125; for the given executor.</span><br><span class="line">      */</span><br><span class="line">     public DiscardOldestPolicy() &#123; &#125;</span><br><span class="line"></span><br><span class="line">     /**</span><br><span class="line">      * Obtains and ignores the next task that the executor</span><br><span class="line">      * would otherwise execute, if one is immediately available,</span><br><span class="line">      * and then retries execution of task r, unless the executor</span><br><span class="line">      * is shut down, in which case task r is instead discarded.</span><br><span class="line">      *</span><br><span class="line">      * @param r the runnable task requested to be executed</span><br><span class="line">      * @param e the executor attempting to execute this task</span><br><span class="line">      */</span><br><span class="line">     public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="line">         if (!e.isShutdown()) &#123;</span><br><span class="line">             e.getQueue().poll();</span><br><span class="line">             e.execute(r);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>该策略就稍微复杂一些，在pool没有关闭的前提下首先丢掉缓存在队列中的最早的任务，然后重新尝试运行该任务。这个策略需要适当小心。<br>设想:如果其他线程都还在运行，那么新来任务踢掉旧任务，缓存在queue中，再来一个任务又会踢掉queue中最老任务。</p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-02T13:23:22.000Z">2017-07-02</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/数据结构与算法/">数据结构与算法</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 883 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/02/图解二叉树的三种遍历方式及java实现/">图解二叉树的三种遍历方式及java实现</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>二叉树(binary tree)是一颗树，其中每个节点都不能有多于两个的儿子。</p>
</blockquote>
<h3 id="1-二叉树节点"><a href="#1-二叉树节点" class="headerlink" title="1.二叉树节点"></a>1.二叉树节点</h3><blockquote>
<p>作为图的特殊形式，二叉树的基本组成单元是节点与边；作为数据结构，其基本的组成实体是二叉树节点（binary tree node），而边则对应于节点之间的相互引用。 </p>
</blockquote>
<p>如下，给出了二叉树节点的数据结构图示和相关代码：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-73a611a8ec25d266.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   // 定义节点类：</span><br><span class="line">private static class BinNode &#123;</span><br><span class="line">	private Object element;</span><br><span class="line">	private BinNode lChild;// 定义指向左子树的指针</span><br><span class="line">	private BinNode rChild;// 定义指向右子树的指针</span><br><span class="line"></span><br><span class="line">	public BinNode(Object element, BinNode lChild, BinNode rChild) &#123;</span><br><span class="line">		this.element = element;</span><br><span class="line">		this.lChild = lChild;</span><br><span class="line">		this.rChild = rChild;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-递归遍历"><a href="#2-递归遍历" class="headerlink" title="2.递归遍历"></a>2.递归遍历</h3><blockquote>
<p>二叉树本身并不具有天然的全局次序，故为实现遍历，需通过在各节点与其孩子之间约定某种局部次序，间接地定义某种全局次序。<br>按惯例左兄弟优先于右兄弟，故若将节点及其孩子分别记作V、L和R，则下图所示，局部访问的次序可有VLR、LVR和LRV三种选择。根据节点V在其中的访问次序，三种策略也相应地分别称作先序遍历、中序遍历和后序遍历，下面将分别介绍。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-78c9cd6df1403a82.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h5 id="2-1-先序遍历"><a href="#2-1-先序遍历" class="headerlink" title="2.1 先序遍历"></a>2.1 先序遍历</h5><p>图示：<br><img src="http://upload-images.jianshu.io/upload_images/5990755-47c53131836404bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>代码实现：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   /**</span><br><span class="line"> * 对该二叉树进行前序遍历 结果存储到list中 前序遍历</span><br><span class="line"> */</span><br><span class="line">public static void preOrder(BinNode node) &#123;</span><br><span class="line">	list.add(node); // 先将根节点存入list</span><br><span class="line">	// 如果左子树不为空继续往左找，在递归调用方法的时候一直会将子树的根存入list，这就做到了先遍历根节点</span><br><span class="line">	if (node.lChild != null) &#123;</span><br><span class="line">		preOrder(node.lChild);</span><br><span class="line">	&#125;</span><br><span class="line">	// 无论走到哪一层，只要当前节点左子树为空，那么就可以在右子树上遍历，保证了根左右的遍历顺序</span><br><span class="line">	if (node.rChild != null) &#123;</span><br><span class="line">		preOrder(node.rChild);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="2-2-中序遍历"><a href="#2-2-中序遍历" class="headerlink" title="2.2 中序遍历"></a>2.2 中序遍历</h5><p>图示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-10c0543e9fd2fd38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>代码实现：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   /**</span><br><span class="line"> * 对该二叉树进行中序遍历 结果存储到list中</span><br><span class="line"> */</span><br><span class="line">public static void inOrder(BinNode node) &#123;</span><br><span class="line">	if (node.lChild != null) &#123;</span><br><span class="line">		inOrder(node.lChild);</span><br><span class="line">	&#125;</span><br><span class="line">	list.add(node);</span><br><span class="line">	if (node.rChild != null) &#123;</span><br><span class="line">		inOrder(node.rChild);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="2-3-后序遍历"><a href="#2-3-后序遍历" class="headerlink" title="2.3 后序遍历"></a>2.3 后序遍历</h5><p>实例图示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-340e0cb943b5cf8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>代码实现：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   /**</span><br><span class="line"> * 对该二叉树进行后序遍历 结果存储到list中</span><br><span class="line"> */</span><br><span class="line">public static void postOrder(BinNode node) &#123;</span><br><span class="line">	if (node.lChild != null) &#123;</span><br><span class="line">		postOrder(node.lChild);</span><br><span class="line">	&#125;</span><br><span class="line">	if (node.rChild != null) &#123;</span><br><span class="line">		postOrder(node.rChild);</span><br><span class="line">	&#125;</span><br><span class="line">	list.add(node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##附：测试相关代码<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">   private static BinNode root;</span><br><span class="line">private static List&lt;BinNode&gt; list = new ArrayList&lt;BinNode&gt;();</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	init();</span><br><span class="line">	// TODO Auto-generated method stub</span><br><span class="line">	//preOrder(root);</span><br><span class="line">	//inOrder(root);</span><br><span class="line">	postOrder(root);</span><br><span class="line">	for (int i = 0; i &lt; list.size(); i++) &#123;</span><br><span class="line">		System.out.print(list.get(i).element + &quot; &quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 树的初始化:先从叶节点开始,由叶到根</span><br><span class="line">public static void init() &#123;</span><br><span class="line">	BinNode b = new BinNode(&quot;b&quot;, null, null);</span><br><span class="line">	BinNode a = new BinNode(&quot;a&quot;, null, b);</span><br><span class="line">	BinNode c = new BinNode(&quot;c&quot;, a, null);</span><br><span class="line">	</span><br><span class="line">	BinNode e = new BinNode(&quot;e&quot;, null, null);</span><br><span class="line">	BinNode g = new BinNode(&quot;g&quot;, null, null);</span><br><span class="line">	BinNode f = new BinNode(&quot;f&quot;, e, g);</span><br><span class="line">	BinNode h = new BinNode(&quot;h&quot;, f, null);</span><br><span class="line">	</span><br><span class="line">	BinNode d = new BinNode(&quot;d&quot;, c, h);</span><br><span class="line">	</span><br><span class="line">	BinNode j = new BinNode(&quot;j&quot;, null, null);</span><br><span class="line">	BinNode k = new BinNode(&quot;k&quot;, j, null);</span><br><span class="line">	BinNode m = new BinNode(&quot;m&quot;, null, null);</span><br><span class="line">	BinNode o = new BinNode(&quot;o&quot;, null, null);</span><br><span class="line">	BinNode p = new BinNode(&quot;p&quot;, o, null);</span><br><span class="line">	BinNode n = new BinNode(&quot;n&quot;, m, p);</span><br><span class="line">	BinNode l = new BinNode(&quot;l&quot;, k, n);</span><br><span class="line">	</span><br><span class="line">	root = new BinNode(&quot;i&quot;, d, l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-02T01:23:16.000Z">2017-07-02</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/数据结构与算法/">数据结构与算法</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1613 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/02/采用动态规划的思想解决三种经典问题之Java实现/">采用动态规划的思想解决三种经典问题之Java实现</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>  当遇到复杂问题时我们经常会通过递归的方式将大事化小，小事化了。但是有时候将复杂问题简单地分解成几个子问题，问题求解耗时会按问题规模呈幂级数增加。这时候为了节约重复求相同子问题的时间，引入一个数组(或临时变量)，不管它们是否对最终解有用，把所有子问题的解存于该数组(或临时变量)中，这就是动态规划的基本思想。</p>
</blockquote>
<p>###1.Fibonacci数列<br>该数列的递归形式如下，即从每二项开始每一项等于前两项之和：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-fa24b34fef5933d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>根据定义可以用递归方式写出如下代码：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public int fib(int n) &#123; // 计算Fibonacci数列的第n项（二分递归版）：O(2^n)</span><br><span class="line">		return (2 &gt; n) ? n // 若到达递归基，直接取值</span><br><span class="line">				: fib(n - 1) + fib(n - 2); // 否则，递归计算前两项，其和即为正解</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>递规版本的时间复杂度将呈指数级别，明显不能很好的解决问题，现通过牺牲空间复杂度，利用动态规划的思想将时间复杂度控制降低到O(n).<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static int fib1(int n) &#123; // 计算Fibonacci数列的第n项（动态规划版）：O(n)</span><br><span class="line">		if(n &lt; 2) return n;</span><br><span class="line">		int a = 0;//第一个值</span><br><span class="line">		int b = 1;//第二个值</span><br><span class="line">		int tmp = 0;//辅助变量</span><br><span class="line">		for(int i = 2;i &lt;= n;i++)&#123;</span><br><span class="line">			tmp = a + b;</span><br><span class="line">			a = b;</span><br><span class="line">			b = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">		return tmp;		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>###2.爬楼梯</p>
<blockquote>
<p>问题描述：有一座高度为n级的楼梯，从下往上走，每跨一步只能向上1级或者2级台阶，求出一共有多少种走法。</p>
</blockquote>
<p>分析：因为每1步只能走1级或者2级，所以走到第n级的前一步有且只有两种情况，第一种情况是从第n - 1级走1级，第二种情况是从第n - 2级走2级。由此我们就可以得到此问题的递归公式：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">F(1) = 1;</span><br><span class="line">F(2) = 2;</span><br><span class="line">F(n) = F(n - 1) + F(n - 2);</span><br></pre></td></tr></table></figure></p>
<p>看到这里，相信聪明的你很快就反映过来了这不就是上面的Fibonacci数列问题嘛(注意：起始值不同)，下面直接给出动态规划思想的代码实现:<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static int getNum(int n) &#123; </span><br><span class="line">		if(n &lt;= 2) return n;</span><br><span class="line">		int a = 1;//只有1级台阶的情况</span><br><span class="line">		int b = 2;//有2级台阶的情况</span><br><span class="line">		int tmp = 0;//辅助变量</span><br><span class="line">		for(int i = 3;i &lt;= n;i++)&#123;</span><br><span class="line">			tmp = a + b;</span><br><span class="line">			a = b;</span><br><span class="line">			b = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">		return tmp;		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>###3.最长公共子序列<br>有了上面两个动态规划实现的热身，下面看一个复杂点的问题，首先看一下两个定义：<br><strong>子序列(Sequence)</strong>：由序列中若干字符，按原相对次序构成。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-ce98e367a6f841a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>最长公共子序列(Longest Common Subsequence）</strong>:两个序列公共子序列中的最长者，下面简称LCS,可能出现下面两种比较复杂的情况：<br>1).可能有多个</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-6651110eb7bafe13.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>2).可能有歧义</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-bba164e96b17b8d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>现用递归的思想分析如下：<br>对于序列A[0,n]和B[0,m]，LCS(A,B)无非三种情况：<br>1) 若n = - 1或 m = - 1，则取作空序列(“”)<br>2) 若A[n] = ‘X’ = B[m],则取作LCS(A[0,n), B[0,m)) + ‘X’,示意图如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-724e4c2ade960aea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>3) 若A[n] != B[m],则在LCS(A[0,n], B[0,m))与LCS(A[0,n), B[0,m])中取更长者<br>示意图如下：<br><img src="http://upload-images.jianshu.io/upload_images/5990755-681a665fcd5a8419.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>如下图所示，展示了“EDUCATIONAL”和“ADVANTAGE”通过递归思想求最长公共子序列的过程。<br><img src="http://upload-images.jianshu.io/upload_images/5990755-09fa28fe4ce33306.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>代码实现如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   /**</span><br><span class="line"> * 递归方式实现求两个字符串最长公共字序列的长度</span><br><span class="line"> * @param str1 第一个字符串</span><br><span class="line"> * @param m 第一个字符串需要比较的长度</span><br><span class="line"> * @param str2 第二个字符串</span><br><span class="line"> * @param n 第一个字符串需要比较的长度</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public static int lcs(String str1,int m,String str2,int n)&#123;</span><br><span class="line">	if(m == 0 || n == 0) return 0;//如果其中有一个元素为空则返回0</span><br><span class="line">	if(str1.charAt(m - 1) == str2.charAt(n - 1)) </span><br><span class="line">		return lcs(str1,m - 1,str2,n - 1) + 1;//如果需要比较的两个字符串最后一个字符相同则将问题缩小</span><br><span class="line">	//剩下的情况则两个字符串的最后一个字符不相等，取两种情况中的最大值</span><br><span class="line">	return getMax(lcs(str1,m - 1,str2,n),lcs(str1,m,str2,n - 1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看出如果最后一个字符不相等，反而会将问题的规模扩大，当m与n大小接近时，时间复杂度也呈指数级别。下面将考虑通过动态规划的思想来实现：<br>构造一个二维辅助数组，从上往下依次计算，如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-13ef376b45890cef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>代码实现如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">   /**</span><br><span class="line"> * 非递归方式实现求两个字符串最长公共字序列的长度</span><br><span class="line"> * @param str1 第一个字符串</span><br><span class="line"> * @param m 第一个字符串需要比较的长度</span><br><span class="line"> * @param str2 第二个字符串</span><br><span class="line"> * @param n 第一个字符串需要比较的长度</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public static int lcs1(String str1,int m,String str2,int n)&#123;</span><br><span class="line">	if(m == 0 || n == 0) return 0;</span><br><span class="line">	//构建一个m + 1行 n + 1列的辅助二维数组,里面的元素初始值都为0</span><br><span class="line">	int[][] arr = new int[m + 1][n + 1];</span><br><span class="line">	//依次求二维数组中的值</span><br><span class="line">	for(int i = 1;i &lt;= m;i ++)&#123;</span><br><span class="line">		for(int j = 1;j &lt;= n; j ++)&#123;</span><br><span class="line">			//当最后一个字符相等时等于左上角的元素加1</span><br><span class="line">			if(str1.charAt(i - 1) == str2.charAt(j - 1)) arr[i][j] = arr[i - 1][j - 1] + 1;</span><br><span class="line">			//不相等时取紧邻左边元素和上边元素者的大者</span><br><span class="line">			else arr[i][j] = getMax(arr[i - 1][j],arr[i][j - 1]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return arr[m][n];//二维数组右下角的元素即我们需要的值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>总结</strong>：动态规划的思想通过牺牲空间复杂度的方式来大大减小时间复杂度，将自顶而下的计算方式改为自底而上，把已计算过的实例结果制表备查，从而取得非常显著的效果。</p>

        </div>
        
        
        
    </div>
</div>





    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-02T00:48:00.000Z">2017-07-02</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/数据结构与算法/">数据结构与算法</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 minutes read (About 1462 words)
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/02/详解BFS和DFS及Java实现/">详解BFS和DFS及Java实现</a>
            
        </h1>
        <div class="content">
            <h3 id="1-图的表示"><a href="#1-图的表示" class="headerlink" title="1.图的表示"></a>1.图的表示</h3><blockquote>
<p>图是由顶点和边组成，图最常用的两种方法就是邻接表和邻接矩阵。这两种办法分别用表和矩阵的方式描述图中各顶点之间的联系。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-e7a1384f1c36fcfe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>下面分别展示了两种表示上面这个图的方法：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-aa35559cfbf13a01.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="2-图的遍历"><a href="#2-图的遍历" class="headerlink" title="2.图的遍历"></a>2.图的遍历</h3><blockquote>
<p>广度优先遍历和深度优先遍历是遍历图的两种最常用的方法，下面将详细进行介绍。</p>
</blockquote>
<h4 id="2-1-广度优先遍历-BFS"><a href="#2-1-广度优先遍历-BFS" class="headerlink" title="2.1 广度优先遍历(BFS)"></a>2.1 广度优先遍历(BFS)</h4><blockquote>
<p>即Breadth First Search，其主要思想是从起始点开始，将其邻近的所有顶点都加到一个队列（FIFO）中去，然后标记下这些顶点离起始顶点的距离为1.最后将起始顶点标记为已访问，今后就不会再访问。然后再从队列中取出最先进队的顶点A，也取出其周边邻近节点，加入队列末尾，将这些顶点的距离相对A再加1，最后离开这个顶点A。依次下去，直到队列为空为止。从上面描述的过程我们知道每个顶点被访问的次数最多一次（已访问的节点不会再访问），而对于连通图来说，每个顶点都会被访问。加上每个顶点的邻接链表都会被遍历，因此BFS的时间复杂度是Θ（V+E），其中V是顶点个数，E是边数，也就是所有邻接表中的元素个数。为了更好的说明这个过程，下图列出了对一个图的BFS的过程。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-c5d54991b3b77bba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>代码实现：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.LinkedList;</span><br><span class="line">import java.util.Queue;</span><br><span class="line"></span><br><span class="line">public class BFSDemo &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		</span><br><span class="line">		//构造各顶点</span><br><span class="line">		LinkedList&lt;Character&gt; list_s = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_s.add(&apos;w&apos;);</span><br><span class="line">		list_s.add(&apos;r&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_w = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_w.add(&apos;s&apos;);</span><br><span class="line">		list_w.add(&apos;i&apos;);</span><br><span class="line">		list_w.add(&apos;x&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_r = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_r.add(&apos;s&apos;);</span><br><span class="line">		list_r.add(&apos;v&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_x = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_x.add(&apos;w&apos;);</span><br><span class="line">		list_x.add(&apos;i&apos;);</span><br><span class="line">		list_x.add(&apos;u&apos;);</span><br><span class="line">		list_x.add(&apos;y&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_v = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_v.add(&apos;r&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_i = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_i.add(&apos;u&apos;);</span><br><span class="line">		list_i.add(&apos;x&apos;);</span><br><span class="line">		list_i.add(&apos;w&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_u = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_u.add(&apos;i&apos;);</span><br><span class="line">		list_u.add(&apos;x&apos;);</span><br><span class="line">		list_u.add(&apos;y&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_y = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_y.add(&apos;u&apos;);</span><br><span class="line">		list_y.add(&apos;x&apos;);</span><br><span class="line">		</span><br><span class="line">		//构造图</span><br><span class="line">		HashMap&lt;Character, LinkedList&lt;Character&gt;&gt; graph = new HashMap&lt;Character, LinkedList&lt;Character&gt;&gt;();</span><br><span class="line">		graph.put(&apos;s&apos;, list_s);</span><br><span class="line">		graph.put(&apos;w&apos;, list_w);</span><br><span class="line">		graph.put(&apos;r&apos;, list_r);</span><br><span class="line">		graph.put(&apos;x&apos;, list_x);</span><br><span class="line">		graph.put(&apos;v&apos;, list_v);</span><br><span class="line">		graph.put(&apos;i&apos;, list_i);</span><br><span class="line">		graph.put(&apos;y&apos;, list_y);</span><br><span class="line">		graph.put(&apos;u&apos;, list_u);</span><br><span class="line">		//记录每个顶点离起始点的距离，也即最短距离</span><br><span class="line">		HashMap&lt;Character, Integer&gt; dist = new HashMap&lt;Character, Integer&gt;();</span><br><span class="line">		//遍历的起始点</span><br><span class="line">		char start = &apos;s&apos;;</span><br><span class="line">		//调用广度优先方法</span><br><span class="line">		bfs(graph, dist, start);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private static void bfs(HashMap&lt;Character, LinkedList&lt;Character&gt;&gt; graph, HashMap&lt;Character, Integer&gt; dist,</span><br><span class="line">			char start) &#123;</span><br><span class="line">		Queue&lt;Character&gt; q = new LinkedList&lt;&gt;();</span><br><span class="line">		q.add(start);// 将s作为起始顶点加入队列</span><br><span class="line">		dist.put(start, 0);</span><br><span class="line">		int i = 0;</span><br><span class="line">		while (!q.isEmpty()) &#123;</span><br><span class="line">			char top = q.poll();// 取出队首元素</span><br><span class="line">			i++;</span><br><span class="line">			System.out.println(&quot;The &quot; + i + &quot;th element:&quot; + top + &quot; Distance from s is:&quot; + dist.get(top));</span><br><span class="line">			int d = dist.get(top) + 1;// 得出其周边还未被访问的节点的距离</span><br><span class="line">			for (Character c : graph.get(top)) &#123;</span><br><span class="line">				if (!dist.containsKey(c))// 如果dist中还没有该元素说明还没有被访问</span><br><span class="line">				&#123;</span><br><span class="line">					dist.put(c, d);</span><br><span class="line">					q.add(c);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The 1th element:s Distance from s is:0</span><br><span class="line">The 2th element:w Distance from s is:1</span><br><span class="line">The 3th element:r Distance from s is:1</span><br><span class="line">The 4th element:i Distance from s is:2</span><br><span class="line">The 5th element:x Distance from s is:2</span><br><span class="line">The 6th element:v Distance from s is:2</span><br><span class="line">The 7th element:u Distance from s is:3</span><br><span class="line">The 8th element:y Distance from s is:3</span><br></pre></td></tr></table></figure></p>
<h4 id="2-2-深度优先遍历-DFS"><a href="#2-2-深度优先遍历-DFS" class="headerlink" title="2.2 深度优先遍历(DFS)"></a>2.2 深度优先遍历(DFS)</h4><blockquote>
<p>即Depth First Search,深度优先搜索是从起始顶点开始，递归访问其所有邻近节点，比如A节点是其第一个邻近节点，而B节点又是A的一个邻近节点，则DFS访问A节点后再访问B节点，如果B节点有未访问的邻近节点的话将继续访问其邻近节点，否则继续访问A的未访问邻近节点，当所有从A节点出去的路径都访问完之后，继续递归访问除A以外未被访问的邻近节点。具体看下图：</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/5990755-0763a5d005522308.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>代码如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.LinkedList;</span><br><span class="line"></span><br><span class="line">public class DFSDemo &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		//构造各顶点</span><br><span class="line">		LinkedList&lt;Character&gt; list_u = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_u.add(&apos;v&apos;);</span><br><span class="line">		list_u.add(&apos;x&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_v = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_v.add(&apos;y&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_y = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_y.add(&apos;x&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_x = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_x.add(&apos;v&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_w = new LinkedList&lt;Character&gt;();</span><br><span class="line">		list_w.add(&apos;y&apos;);</span><br><span class="line">		list_w.add(&apos;z&apos;);</span><br><span class="line">		LinkedList&lt;Character&gt; list_z = new LinkedList&lt;Character&gt;();</span><br><span class="line">		//构造图</span><br><span class="line">		HashMap&lt;Character, LinkedList&lt;Character&gt;&gt; graph = new HashMap&lt;Character, LinkedList&lt;Character&gt;&gt;();</span><br><span class="line">		graph.put(&apos;u&apos;, list_u);</span><br><span class="line">		graph.put(&apos;v&apos;, list_v);</span><br><span class="line">		graph.put(&apos;y&apos;, list_y);</span><br><span class="line">		graph.put(&apos;x&apos;, list_x);</span><br><span class="line">		graph.put(&apos;w&apos;, list_w);</span><br><span class="line">		graph.put(&apos;z&apos;, list_z);</span><br><span class="line">		</span><br><span class="line">		HashMap&lt;Character, Boolean&gt; visited = new HashMap&lt;Character, Boolean&gt;();</span><br><span class="line">		//调用深度优先遍历方法</span><br><span class="line">		dfs(graph, visited);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private static void dfs(HashMap&lt;Character, LinkedList&lt;Character&gt;&gt; graph, HashMap&lt;Character, Boolean&gt; visited) &#123;</span><br><span class="line">		visit(graph, visited, &apos;u&apos;);// 为了和图中的顺序一样，我认为控制了DFS先访问u节点</span><br><span class="line">		visit(graph, visited, &apos;w&apos;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    //通过一个全局变量count记录了进入每个节点和离开每个节点的时间</span><br><span class="line">	static int count;</span><br><span class="line">	private static void visit(HashMap&lt;Character, LinkedList&lt;Character&gt;&gt; graph, HashMap&lt;Character, Boolean&gt; visited,</span><br><span class="line">			char start) &#123;</span><br><span class="line">		if (!visited.containsKey(start)) &#123;</span><br><span class="line">			count++;</span><br><span class="line">			System.out.println(&quot;The time into element &quot; + start + &quot;:&quot; + count);// 记录进入该节点的时间</span><br><span class="line">			visited.put(start, true);</span><br><span class="line">			for (char c : graph.get(start)) &#123;</span><br><span class="line">				if (!visited.containsKey(c)) &#123;</span><br><span class="line">					visit(graph, visited, c);// 递归访问其邻近节点</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			count++;</span><br><span class="line">			System.out.println(&quot;The time out element &quot; + start + &quot;:&quot; + count);// 记录离开该节点的时间</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The time into element u:1</span><br><span class="line">The time into element v:2</span><br><span class="line">The time into element y:3</span><br><span class="line">The time into element x:4</span><br><span class="line">The time out element x:5</span><br><span class="line">The time out element y:6</span><br><span class="line">The time out element v:7</span><br><span class="line">The time out element u:8</span><br><span class="line">The time into element w:9</span><br><span class="line">The time into element z:10</span><br><span class="line">The time out element z:11</span><br><span class="line">The time out element w:12</span><br></pre></td></tr></table></figure></p>

        </div>
        
        
        
    </div>
</div>






    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/3/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/5/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
            <li><a class="pagination-link is-current" href="/page/4/">4</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/5/">5</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/8/">8</a></li>
            
        </ul>
    </nav>
</div>
</div>
                



<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    <img class="image is-128x128 has-mb-6" src="/images/avatar.png">
                    
                    <p class="is-size-4 is-block">
                        Acamy
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Stay Hungry, Stay foolish
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>HangZhou China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        79
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        19
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        2
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="http://github.com/Acamy">
                Follow</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="http://github.com/Acamy">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="http://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="http://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="http://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">https://hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">https://github.com/ppoffice</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ElasticSearch/">
            <span class="level-start">
                <span class="level-item">ElasticSearch</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Git/">
            <span class="level-start">
                <span class="level-item">Git</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Hadoop/">
            <span class="level-start">
                <span class="level-item">Hadoop</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JAVA基础系列/">
            <span class="level-start">
                <span class="level-item">JAVA基础系列</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JVM/">
            <span class="level-start">
                <span class="level-item">JVM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JavaWeb/">
            <span class="level-start">
                <span class="level-item">JavaWeb</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JavaWeb框架/">
            <span class="level-start">
                <span class="level-item">JavaWeb框架</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Oracle/">
            <span class="level-start">
                <span class="level-item">Oracle</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/SpringBoot2-0/">
            <span class="level-start">
                <span class="level-item">SpringBoot2.0</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/flowable/">
            <span class="level-start">
                <span class="level-item">flowable</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/在线编程/">
            <span class="level-start">
                <span class="level-item">在线编程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据结构与算法/">
            <span class="level-start">
                <span class="level-item">数据结构与算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/源码/">
            <span class="level-start">
                <span class="level-item">源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/编程/">
            <span class="level-start">
                <span class="level-item">编程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/编程/java/">
            <span class="level-start">
                <span class="level-item">java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/计算机网络/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/设计模式/">
            <span class="level-start">
                <span class="level-item">设计模式</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/随笔/">
            <span class="level-start">
                <span class="level-item">随笔</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/优化/" style="font-size: 10px;">优化</a> <a href="/tags/线程池/" style="font-size: 10px;">线程池</a>
    </div>
</div>

    
    
        <div class="card card-transparent is-hidden-widescreen">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2018/11/03/采用线程池处理异步任务并获取最终结果/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/thumbnails/plant.jpg" alt="采用线程池处理异步任务并获取最终结果">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T15:44:39.000Z">2018-11-03</time></div>
                    <a href="/2018/11/03/采用线程池处理异步任务并获取最终结果/" class="has-link-black-ter is-size-6">采用线程池处理异步任务并获取最终结果</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/编程/">编程</a> / <a class="has-link-grey -link" href="/categories/编程/java/">java</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/21/记一次不太成功的频繁full gc排查过程/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="记一次不太成功的频繁full gc排查过程">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-21T14:00:49.000Z">2018-10-21</time></div>
                    <a href="/2018/10/21/记一次不太成功的频繁full gc排查过程/" class="has-link-black-ter is-size-6">记一次不太成功的频繁full gc排查过程</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JVM/">JVM</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/19/mac下编译OpenJDK10/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="mac下编译OpenJDK10">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-19T12:21:37.000Z">2018-10-19</time></div>
                    <a href="/2018/10/19/mac下编译OpenJDK10/" class="has-link-black-ter is-size-6">mac下编译OpenJDK10</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JVM/">JVM</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/14/AWS V4签名认证(Java实现)/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="AWS V4签名认证(Java实现)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-14T05:00:50.000Z">2018-10-14</time></div>
                    <a href="/2018/10/14/AWS V4签名认证(Java实现)/" class="has-link-black-ter is-size-6">AWS V4签名认证(Java实现)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/随笔/">随笔</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/10/git常用命令/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="git常用命令">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-10T03:46:23.000Z">2018-10-10</time></div>
                    <a href="/2018/10/10/git常用命令/" class="has-link-black-ter is-size-6">git常用命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">October 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">June 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">36</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/优化/">
                        <span class="level-start">
                            <span class="level-item">优化</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/线程池/">
                        <span class="level-start">
                            <span class="level-item">线程池</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                



<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2018/11/03/采用线程池处理异步任务并获取最终结果/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://blog.zhangruipeng.me/hexo-theme-icarus/gallery/thumbnails/plant.jpg" alt="采用线程池处理异步任务并获取最终结果">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T15:44:39.000Z">2018-11-03</time></div>
                    <a href="/2018/11/03/采用线程池处理异步任务并获取最终结果/" class="has-link-black-ter is-size-6">采用线程池处理异步任务并获取最终结果</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/编程/">编程</a> / <a class="has-link-grey -link" href="/categories/编程/java/">java</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/21/记一次不太成功的频繁full gc排查过程/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="记一次不太成功的频繁full gc排查过程">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-21T14:00:49.000Z">2018-10-21</time></div>
                    <a href="/2018/10/21/记一次不太成功的频繁full gc排查过程/" class="has-link-black-ter is-size-6">记一次不太成功的频繁full gc排查过程</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JVM/">JVM</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/19/mac下编译OpenJDK10/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="mac下编译OpenJDK10">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-19T12:21:37.000Z">2018-10-19</time></div>
                    <a href="/2018/10/19/mac下编译OpenJDK10/" class="has-link-black-ter is-size-6">mac下编译OpenJDK10</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/JVM/">JVM</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/14/AWS V4签名认证(Java实现)/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="AWS V4签名认证(Java实现)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-14T05:00:50.000Z">2018-10-14</time></div>
                    <a href="/2018/10/14/AWS V4签名认证(Java实现)/" class="has-link-black-ter is-size-6">AWS V4签名认证(Java实现)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/随笔/">随笔</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/10/10/git常用命令/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="git常用命令">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-10-10T03:46:23.000Z">2018-10-10</time></div>
                    <a href="/2018/10/10/git常用命令/" class="has-link-black-ter is-size-6">git常用命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">October 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">June 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">36</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/优化/">
                        <span class="level-start">
                            <span class="level-item">优化</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/线程池/">
                        <span class="level-start">
                            <span class="level-item">线程池</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2018 John Doe&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-icarus">Icarus</a>
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="http://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>
    <script>
        (function ($) {
            $(document).ready(function () {
                if (typeof($.fn.lightGallery) === 'function') {
                    $('.article').lightGallery({ selector: '.gallery-item' });
                }
                if (typeof($.fn.justifiedGallery) === 'function') {
                    $('.justified-gallery').justifiedGallery();
                }
            });
        })(jQuery);
    </script>
    

    
    
    
    <div id="outdated">
        <h6>Your browser is out-of-date!</h6>
        <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
        <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js"></script>
    <script>
        $(document).ready(function () {
            // plugin function, place inside DOM ready function
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'flex'
            })
        });
    </script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/animejs@2.2.0/anime.js"></script>
    <script>
    function isIE() {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf('MSIE ');
        var trident = ua.indexOf('Trident/');
        return (msie > 0 || trident > 0);
    }

    $(document).ready(function () {
        $('body>.navbar,body>.section,body>.footer').css('opacity', 1);
        if (!isIE()) {
            ['.column-main > .card',
             '.column-left > .card',
             '.column-right > .card'].map(function(target) {
                anime({
                    targets: target,
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutSine',
                    delay: function(el, i, l) {
                        return i * 100;
                    }
                })
            });

            anime({
                targets: '.navbar-main',
                translateY: [-100, 0],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutSine'
            });
        }
    });
    </script>
    

    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<style>
#back-to-top {
    position: fixed;
    padding: 8px 0;
    transition: 0.4s ease opacity, 0.4s ease width, 0.4s ease transform, 0.4s ease border-radius;
    opacity: 0;
    line-height: 24px;
    outline: none;
    transform: translateY(120px);
}
#back-to-top.fade-in {
    opacity: 1;
}
#back-to-top.rise-up {
    transform: translateY(0);
}
</style>
<script src="/js/back-to-top.js"></script>


    
    

    
    
    
    

    
    
    


<script src="/js/main.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>